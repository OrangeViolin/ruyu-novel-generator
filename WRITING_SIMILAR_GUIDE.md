# 📚 写同款功能 - 使用指南

## 🎉 功能概述

基于您的小说和拆文素材，系统现在支持"写同款"功能，可以：
- 上传小说素材（.txt, .docx, .pdf）
- AI自动分析提取人设、冲突、风格等
- 一键生成同款作品
- 推荐相似素材

---

## 🚀 快速开始

### 第一步：上传素材

1. 打开浏览器访问: **http://127.0.0.1:8000**
2. 点击 **📚 素材库** 标签页（已在首页）
3. 点击 **+ 上传素材** 按钮
4. 填写信息：
   - **作品标题**（必填）：如《他曾是我人间朝暮》
   - **作者**（可选）：如"顾以"
   - **来源**（可选）：番茄、七猫、晋江等
   - **内容类型**（必填）：选择"导语"、"大纲"、"拆解笔记"或"完整小说"
   - **上传文件**（必填）：支持 .txt、.docx、.pdf 格式
   - **备注**（可选）：可以记录这个素材的特点
5. 点击 **上传并分析**

### 第二步：等待AI分析

- 上传成功后，系统会自动启动AI分析
- 分析包括：
  - 🎭 **题材识别**：世情文、追妻火葬场、豪门恩怨等
  - 🏷️ **标签提取**：狗血、虐恋、复仇等
  - ⚔️ **核心冲突**：提取故事的主要矛盾
  - 😢 **情绪风格**：压抑、爆发、温暖等
  - ✍️ **写作风格**：描述文风特点
  - 👥 **人物提取**：自动识别主要角色和特征

分析需要10-30秒，素材卡片会显示"分析中"状态。

### 第三步：使用素材

#### 方式1：查看详情并写同款

1. 点击素材卡片的 **查看** 按钮
2. 查看完整的AI分析结果
3. 点击 **✨ 写同款** 按钮
4. AI会基于该素材的风格生成新的导语/内容
5. 可以复制结果使用

#### 方式2：直接写同款

- 对于分析完成的素材，卡片上会显示 **写同款** 按钮
- 点击即可快速生成

#### 方式3：查找相似素材

1. 打开素材详情
2. 点击 **🔍 找相似** 按钮
3. 系统会推荐题材和标签相似的其他素材
4. 可以查看这些素材并用于创作

---

## 📖 使用场景示例

### 场景1：基于导语生成同款

**已上传素材**：
- 标题：《他曾是我人间朝暮》
- 导语内容：关于彩礼、捞女、离婚的经典狗血桥段

**操作**：
1. 上传该素材，选择内容类型为"导语"
2. 等待AI分析（识别为"世情文"、"追妻火葬场"等）
3. 点击"写同款"
4. AI生成类似结构的导语，保持狗血程度

### 场景2：基于拆解笔记学习结构

**已上传素材**：
- 标题：《某某小说拆解笔记》
- 内容：完整的人设、冲突、情节分析

**操作**：
1. 上传拆解笔记，内容类型选择"拆解笔记"
2. AI会提取其中的结构要素
3. 可以查看分析结果，学习其设定
4. 点击"写同款"生成类似结构的新设定

### 场景3：建立个人素材库

**建立流程**：
1. 收集您喜欢的小说导语/大纲
2. 批量上传到素材库
3. AI自动分析并分类
4. 通过筛选器快速找到：
   - 相同题材的素材
   - 相似风格的素材
   - 某个作者的作品
5. 使用这些素材作为参考，生成同款作品

---

## 🎯 素材分析详细说明

### AI会提取什么？

| 字段 | 说明 | 示例 |
|------|------|------|
| **题材** | 作品类型 | 世情文、追妻火葬场、豪门恩怨 |
| **标签** | 关键标签 | 狗血、虐恋、复仇、误会 |
| **核心冲突** | 主要矛盾 | 金钱与爱情的冲突、身份差带来的偏见 |
| **情绪风格** | 情绪基调 | 压抑→爆发、温暖治愈、虐心 |
| **写作风格** | 文风特点 | 简洁有力、细节丰富、对话驱动 |
| **人物** | 角色信息 | 主角：XX，性格倔强，动机... |

### 分析状态说明

- **待分析**（黄色）：刚上传，还没开始分析
- **分析中**（蓝色）：AI正在分析，请等待
- **已完成**（绿色）：分析完成，可以使用所有功能
- **分析失败**（红色）：分析失败，可能是文件格式问题

---

## 💡 最佳实践

### 1. 素材命名规范

好的命名示例：
- ✅ 《他曾是我人间朝暮》- 导语
- ✅ 追妻火葬场系列-拆解笔记
- ✅ 番茄热门-大纲模板

### 2. 内容类型选择

| 上传内容 | 选择类型 | 用途 |
|---------|---------|------|
| 小说的开头部分 | 导语 | 用于生成新导语 |
| 章节大纲/完整大纲 | 大纲 | 用于生成新大纲 |
| 手写的拆解笔记 | 拆解笔记 | AI学习结构并生成 |
| 完整的小说文件 | 完整小说 | 提取整体风格 |

### 3. 批量上传建议

如果您有多个素材：
1. 先上传一个测试，确认AI分析效果
2. 确认无误后，再批量上传其他素材
3. 使用筛选器管理大量素材

---

## 🔧 高级功能

### 筛选素材

使用顶部筛选器可以：
- 按内容类型筛选：导语、大纲、拆解笔记、完整小说
- 按题材筛选：世情文、追妻火葬场、豪门恩怨等

### 推荐算法

系统会根据以下因素推荐相似素材：
1. 相同的题材类型
2. 重叠的标签
3. 相似的核心冲突

### 文件支持

| 格式 | 说明 | 需要安装 |
|------|------|---------|
| .txt | 纯文本文件 | 无需额外安装 |
| .docx | Word文档 | `pip install python-docx` |
| .pdf | PDF文件 | `pip install PyPDF2` |

---

## 📊 API端点参考

### 素材管理

| 方法 | 端点 | 说明 |
|------|------|------|
| GET | `/api/materials` | 获取素材列表 |
| POST | `/api/materials/upload` | 上传素材文件 |
| GET | `/api/materials/{id}` | 获取素材详情 |
| POST | `/api/materials/{id}/analyze` | 手动触发分析 |

### 写同款功能

| 方法 | 端点 | 说明 |
|------|------|------|
| POST | `/api/materials/{id}/write-similar` | 基于素材生成同款 |
| GET | `/api/materials/{id}/similar` | 查找相似素材 |

---

## 🎨 界面说明

### 素材卡片

```
┌─────────────────────────────┐
│ 《作品名称》     [已完成]    │
│ 👤 作者  📖 来源  🏷️ 题材   │
│ [标签1] [标签2] [标签3]      │
│ 核心冲突：XXX...             │
│ 情绪：XXX                    │
│ ─────────────────────────── │
│ 👁️ 10  [查看] [写同款]      │
└─────────────────────────────┘
```

### 操作按钮

- **查看**：查看详细的分析结果
- **写同款**：立即生成同款作品（仅分析完成后可用）
- **找相似**：查找相似的素材（在详情页）

---

## 🐛 常见问题

### Q1: 上传后一直显示"分析中"

**A**: AI分析需要10-30秒，请耐心等待。如果超过1分钟还在分析，可能是：
- 文件内容过长（建议控制在5000字以内）
- AI API响应慢（可以重试）
- 网络问题

### Q2: 分析失败怎么办？

**A**: 可能的原因：
- 文件格式不支持（只支持.txt、.docx、.pdf）
- 文件内容为空或编码问题
- AI API调用失败

**解决方法**：检查文件，重新上传。

### Q3: 写同款的结果不满意？

**A**: 可以尝试：
1. 上传更多同类型的素材，系统会学习
2. 查看素材的分析结果，确保标签准确
3. 在详情页手动查看分析结果，调整素材

### Q4: 如何批量导入已有素材？

**A**:
1. 将素材整理成 .txt 文件（推荐）
2. 在界面中逐个上传
3. 或者等待批量导入功能开发

---

## 📦 文件结构

```
novel-generator/
├── uploads/materials/        # 素材文件存储目录
├── backend/
│   ├── database/
│   │   └── models.py (新增: ReferenceMaterial)
│   └── api/
│       └── app.py (新增: 素材管理API)
├── frontend/
│   ├── index.html (新增: 素材库标签页和模态框)
│   └── static/
│       ├── js/
│       │   └── materials.js (新文件)
│       └── css/
│           └── style.css (新增: 素材库样式)
```

---

## 🎯 下一步计划

- [ ] 批量上传功能
- [ ] 素材导出功能
- [ ] 更智能的推荐算法
- [ ] 素材收藏和分组
- [ ] 使用统计分析（最常用的素材）
- [ ] 支持更多文件格式（.epub等）

---

**服务器地址**: http://127.0.0.1:8000

**默认状态**: 📚 素材库标签页已激活，可以立即使用！

**开始使用**: 点击 "+ 上传素材" 按钮，上传您的第一个小说素材吧！
