<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>如鱼写作 - 如鱼得水，丝滑创作</title>
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><defs><linearGradient id='grad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' style='stop-color:%236366f1'/><stop offset='100%' style='stop-color:%234f46e5'/></linearGradient></defs><rect width='32' height='32' rx='6' fill='url(%23grad)'/><text x='16' y='22' font-family='Arial' font-size='18' font-weight='bold' fill='white' text-anchor='middle'>✍️</text></svg>">
    <link rel="stylesheet" href="/static/css/style.css?v=9">
</head>

<body>
    <div id="app">
        <!-- 顶部导航 -->
        <nav class="navbar">
            <div class="nav-brand">
                <img src="/static/assets/logo.png" alt="如鱼写作" class="logo">
                <div class="brand-text">
                    <h1>如鱼写作</h1>
                    <span class="brand-slogan">如鱼得水，丝滑创作</span>
                </div>
            </div>
            <div class="nav-links">
                <div class="model-selector">
                    <label for="model-provider-select">🤖 模型:</label>
                    <select id="model-provider-select" class="nav-select">
                        <option value="deepseek" selected>DeepSeek (官方)</option>
                        <optgroup label="Claude (Aggregator)">
                            <option value="claude-opus-4-5-thinking">Claude Opus 4.5</option>
                            <option value="claude-sonnet-4-5">Claude Sonnet 4.5</option>
                        </optgroup>
                        <optgroup label="GPT (Aggregator)">
                            <option value="gpt-4o">GPT-4o</option>
                            <option value="gpt-5">GPT-5</option>
                        </optgroup>
                        <optgroup label="Gemini (Aggregator)">
                            <option value="gemini-3.0-pro">Gemini 3.0 Pro</option>
                        </optgroup>
                        <optgroup label="Grok (Aggregator)">
                            <option value="grok-4">Grok 4</option>
                        </optgroup>
                    </select>
                </div>
                <button class="nav-btn" data-tab="short-story">📝 短故事助手</button>
                <button class="nav-btn" data-tab="long-novel">📚 长故事助手</button>
                <button class="nav-btn" data-tab="batch-generation">🚀 批量生成</button>
                <button class="nav-btn" data-tab="imitation">✨ 仿写生成系统</button>
                <button class="nav-btn" data-tab="inspiration">💡 创作灵感助手</button>
            </div>
        </nav>

        <!-- 主内容区 -->
        <main class="main-content">
            <!-- 灵感鱼缸 (Floating Bubbles) -->
            <aside id="inspiration-aquarium" class="aquarium">
                <div class="aquarium-header">
                    <h4>🐟 灵感鱼缸</h4>
                    <p>点击气泡喂入灵感</p>
                </div>
                <div id="bubble-container" class="bubble-container">
                    <!-- 气泡将由JS动态生成 -->
                </div>
            </aside>


            <!-- 创作灵感助手标签页 -->
            <div id="tab-inspiration" class="tab-content">
                <div class="inspiration-panel">
                    <div class="panel-header">
                        <h2>💡 创作灵感助手</h2>
                        <p class="panel-desc">从灵感到成文,五步完成小说创作</p>
                    </div>

                    <!-- 步骤指示器 -->
                    <div class="step-indicator">
                        <div class="step active" data-step="1">
                            <div class="step-number">1</div>
                            <div class="step-label">灵感收集</div>
                        </div>
                        <div class="step-arrow">→</div>
                        <div class="step" data-step="2">
                            <div class="step-number">2</div>
                            <div class="step-label">生成设定</div>
                        </div>
                        <div class="step-arrow">→</div>
                        <div class="step" data-step="3">
                            <div class="step-number">3</div>
                            <div class="step-label">生成大纲</div>
                        </div>
                        <div class="step-arrow">→</div>
                        <div class="step" data-step="4">
                            <div class="step-number">4</div>
                            <div class="step-label">生成细章</div>
                        </div>
                        <div class="step-arrow">→</div>
                        <div class="step" data-step="5">
                            <div class="step-number">5</div>
                            <div class="step-label">一键成文</div>
                        </div>
                    </div>

                    <!-- 步骤1: 灵感收集 -->
                    <div id="inspiration-step-1" class="step-content active">
                        <div class="step-header">
                            <h3>📝 第一步: 灵感收集</h3>
                            <p>填写您的初步想法,留空将由AI随机生成</p>
                        </div>
                        <form id="inspiration-form" class="inspiration-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>故事简介</label>
                                    <textarea id="inspiration-summary" rows="3"
                                        placeholder="例如:一个现代都市女性穿越到古代成为公主的故事..."></textarea>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>目标读者</label>
                                    <select id="inspiration-readers">
                                        <option value="">AI随机生成</option>
                                        <option value="young">青少年 (12-18岁)</option>
                                        <option value="young_adult">年轻成人 (18-30岁)</option>
                                        <option value="adult">成人 (30-50岁)</option>
                                        <option value="all">全年龄</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>小说类型</label>
                                    <select id="inspiration-genre">
                                        <option value="">AI随机生成</option>
                                        <option value="romance">言情小说</option>
                                        <option value="fantasy">玄幻小说</option>
                                        <option value="urban">都市小说</option>
                                        <option value="historical">历史小说</option>
                                        <option value="scifi">科幻小说</option>
                                        <option value="mystery">悬疑小说</option>
                                        <option value="wuxia">武侠小说</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>章节数量</label>
                                    <select id="inspiration-chapters">
                                        <option value="">AI随机生成</option>
                                        <option value="5">5章 (短篇)</option>
                                        <option value="10">10章 (中短篇)</option>
                                        <option value="20">20章 (中篇)</option>
                                        <option value="30">30章 (长篇)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>目标字数</label>
                                    <select id="inspiration-words">
                                        <option value="">AI随机生成</option>
                                        <option value="5000">5000字 (微短篇)</option>
                                        <option value="10000">10000字 (短篇)</option>
                                        <option value="30000">30000字 (中篇)</option>
                                        <option value="50000">50000字 (长篇)</option>
                                        <option value="100000">100000字 (超长篇)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>写作元素建议 (可选,多个用逗号分隔)</label>
                                <input type="text" id="inspiration-elements" placeholder="例如:重生,复仇,豪门恩怨,身份错位...">
                            </div>
                            <div class="form-actions">
                                <button type="button" class="btn btn-primary" onclick="generateInpiration()">✨
                                    AI生成设定</button>
                                <button type="button" class="btn btn-success" onclick="startOneClickGeneration()"
                                    style="background-color: #10b981; margin-left: 10px;">🚀 一键生成全书</button>
                            </div>
                        </form>
                    </div>

                    <!-- 步骤2: 生成设定 -->
                    <div id="inspiration-step-2" class="step-content" style="display: none;">
                        <div class="step-header">
                            <h3>📚 第二步: 小说设定</h3>
                            <p>AI为您生成的完整小说设定,可编辑修改</p>
                        </div>
                        <div id="settings-content" class="settings-content">
                            <div class="loading-state">
                                <p>⏳ AI正在创作中,请稍候...</p>
                            </div>
                        </div>
                        <div class="form-actions" id="step-2-actions" style="display: none;">
                            <button type="button" class="btn" onclick="backToStep(1)">← 返回上一步</button>
                            <button type="button" class="btn btn-primary" onclick="generateOutline()">→ 生成大纲</button>
                        </div>
                    </div>

                    <!-- 步骤3: 生成大纲 -->
                    <div id="inspiration-step-3" class="step-content" style="display: none;">
                        <div class="step-header">
                            <h3>📋 第三步: 章节大纲</h3>
                            <p>基于设定生成的详细章节大纲</p>
                        </div>
                        <div id="outline-content" class="outline-content">
                            <div class="loading-state">
                                <p>⏳ AI正在生成大纲,请稍候...</p>
                            </div>
                        </div>
                        <div class="form-actions" id="step-3-actions" style="display: none;">
                            <button type="button" class="btn" onclick="backToStep(2)">← 返回上一步</button>
                            <button type="button" class="btn btn-primary" onclick="generateChapters()">→ 生成细章</button>
                        </div>
                    </div>

                    <!-- 步骤4: 生成细章 -->
                    <div id="inspiration-step-4" class="step-content" style="display: none;">
                        <div class="step-header">
                            <h3>📖 第四步: 章节内容</h3>
                            <p>基于大纲生成的完整章节内容</p>
                        </div>
                        <div id="chapters-content" class="chapters-content">
                            <div class="loading-state">
                                <p>⏳ AI正在创作章节,请稍候...</p>
                            </div>
                        </div>
                        <div class="form-actions" id="step-4-actions" style="display: none;">
                            <button type="button" class="btn" onclick="backToStep(3)">← 返回上一步</button>
                            <button type="button" class="btn btn-primary" onclick="generateNovel()">→ 一键成文</button>
                        </div>
                    </div>

                    <!-- 步骤5: 一键成文 -->
                    <div id="inspiration-step-5" class="step-content" style="display: none;">
                        <div class="step-header">
                            <h3>🎉 第五步: 完成</h3>
                            <p>您的小说已生成完毕!</p>
                        </div>
                        <div id="novel-result" class="novel-result">
                            <div class="loading-state">
                                <p>⏳ 正在整合成文,请稍候...</p>
                            </div>
                        </div>
                        <div class="form-actions" id="step-5-actions" style="display: none;">
                            <button type="button" class="btn" onclick="exportNovel()">📥 导出小说</button>
                            <button type="button" class="btn btn-primary" onclick="resetInspiration()">🔄 重新创作</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 短故事助手标签页 -->
            <div id="tab-short-story" class="tab-content active">
                <div class="inspiration-panel">
                    <div class="panel-header">
                        <h2>📝 短故事创作助手</h2>
                        <p class="panel-desc">3万字以内短篇完结故事,节奏紧凑,剧情跌宕</p>
                    </div>

                    <!-- 步骤指示器 -->
                    <div class="step-indicator">
                        <div class="step active" data-step="1">
                            <div class="step-number">1</div>
                            <div class="step-label">灵感收集</div>
                        </div>
                        <div class="step-arrow">→</div>
                        <div class="step" data-step="2">
                            <div class="step-number">2</div>
                            <div class="step-label">生成设定</div>
                        </div>
                        <div class="step-arrow">→</div>
                        <div class="step" data-step="3">
                            <div class="step-number">3</div>
                            <div class="step-label">生成大纲</div>
                        </div>
                        <div class="step-arrow">→</div>
                        <div class="step" data-step="4">
                            <div class="step-number">4</div>
                            <div class="step-label">生成章节</div>
                        </div>
                        <div class="step-arrow">→</div>
                        <div class="step" data-step="5">
                            <div class="step-number">5</div>
                            <div class="step-label">一键成文</div>
                        </div>
                        <div class="step-arrow">→</div>
                        <div class="step" data-step="6">
                            <div class="step-number">6</div>
                            <div class="step-label">AI审稿</div>
                        </div>
                        <div class="step-arrow">→</div>
                        <div class="step" onclick="showManuscriptHistory()"
                            style="cursor: pointer; background: #e0e7ff; border-color: #6366f1;">
                            <div class="step-number" style="background: #6366f1;">📚</div>
                            <div class="step-label" style="color: #6366f1; font-weight: bold;">历史稿件</div>
                        </div>
                    </div>

                    <!-- 步骤1: 灵感收集 -->
                    <div id="short-story-step-1" class="step-content active">
                        <div class="step-header">
                            <h3>📝 第一步: 灵感收集</h3>
                            <p>选择题材、爆点梗,填写灵感(留空则AI随机生成)</p>
                        </div>
                        <form id="short-story-form" class="inspiration-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>题材类型 *</label>
                                    <select id="short-story-genre" required>
                                        <option value="">请选择题材</option>
                                        <optgroup label="现代言情">
                                            <option value="现言甜宠">现言甜宠</option>
                                            <option value="现言虐恋">现言虐恋 (极致拉扯)</option>
                                            <option value="现实情感">现实情感</option>
                                            <option value="种田经商">种田经商</option>
                                        </optgroup>
                                        <optgroup label="古代言情">
                                            <option value="古言甜宠">古言甜宠</option>
                                            <option value="古言虐恋">古言虐恋</option>
                                        </optgroup>
                                        <optgroup label="悬疑/脑洞">
                                            <option value="悬疑推理">悬疑推理</option>
                                            <option value="规则怪谈">规则怪谈</option>
                                            <option value="无限流">无限流</option>
                                            <option value="末日幻想">末日幻想</option>
                                        </optgroup>
                                        <optgroup label="轻松日常">
                                            <option value="搞笑日常">搞笑日常</option>
                                            <option value="田园生活">田园生活</option>
                                        </optgroup>
                                        <optgroup label="其他题材">
                                            <option value="现实生活">现实生活</option>
                                            <option value="科幻">科幻</option>
                                            <option value="自然冒险">自然冒险</option>
                                        </optgroup>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>叙事视角</label>
                                    <select id="short-story-perspective">
                                        <option value="first">第一人称</option>
                                        <option value="third">第三人称</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>爆点梗选择 (可多选)</label>
                                <div class="checkbox-group"
                                    style="max-height: 150px; overflow-y: auto; border: 1px solid #e5e7eb; padding: 1rem; border-radius: 8px;">
                                    <label><input type="checkbox" name="short-story-trope" value="心灰意冷"> 心灰意冷</label>
                                    <label><input type="checkbox" name="short-story-trope" value="复婚学乖"> 复婚学乖</label>
                                    <label><input type="checkbox" name="short-story-trope" value="重生只要家产">
                                        重生只要家产</label>
                                    <label><input type="checkbox" name="short-story-trope" value="久别重逢"> 久别重逢</label>
                                    <label><input type="checkbox" name="short-story-trope" value="替罪梗"> 替罪梗</label>
                                    <label><input type="checkbox" name="short-story-trope" value="换子疑云"> 换子疑云</label>
                                    <label><input type="checkbox" name="short-story-trope" value="听心声"> 听心声</label>
                                    <label><input type="checkbox" name="short-story-trope" value="萌宝"> 萌宝</label>
                                    <label><input type="checkbox" name="short-story-trope" value="真假千金"> 真假千金</label>
                                    <label><input type="checkbox" name="short-story-trope" value="地下恋当众社死">
                                        地下恋当众社死</label>
                                    <label><input type="checkbox" name="short-story-trope" value="新欢打脸"> 新欢打脸</label>
                                    <label><input type="checkbox" name="short-story-trope" value="丁克"> 坚持丁克</label>
                                    <label><input type="checkbox" name="short-story-trope" value="出轨"> 婚内出轨</label>
                                    <label><input type="checkbox" name="short-story-trope" value="渣男悔过"> 渣男悔过</label>
                                    <label><input type="checkbox" name="short-story-trope" value="死人文学">
                                        死人文学(白月光/必死)</label>
                                    <label><input type="checkbox" name="short-story-trope" value="追妻火葬场"> 追妻火葬场</label>
                                    <label><input type="checkbox" name="short-story-trope" value="真假千金"> 真假千金</label>
                                    <label><input type="checkbox" name="short-story-trope" value="破镜重圆"> 破镜重圆</label>
                                    <label><input type="checkbox" name="short-story-trope" value="替身文学"> 替身文学</label>
                                    <label><input type="checkbox" name="short-story-trope" value="带球跑"> 带球跑</label>
                                    <label><input type="checkbox" name="short-story-trope" value="绿茶"> 绿茶/白莲花</label>
                                    <label><input type="checkbox" name="short-story-trope" value="重生致富"> 重生致富</label>
                                    <label><input type="checkbox" name="short-story-trope" value="复仇"> 复仇打脸</label>
                                    <label><input type="checkbox" name="short-story-trope" value="马甲"> 掉马甲</label>
                                    <label><input type="checkbox" name="short-story-trope" value="团宠"> 团宠</label>
                                    <label><input type="checkbox" name="short-story-trope" value="玄学"> 玄学大佬</label>
                                    <label><input type="checkbox" name="short-story-trope" value="娱乐圈"> 娱乐圈</label>
                                    <label><input type="checkbox" name="short-story-trope" value="年代文"> 年代文</label>
                                    <label><input type="checkbox" name="short-story-trope" value="末世囤货"> 末世囤货</label>
                                    <label><input type="checkbox" name="short-story-trope" value="无限流"> 无限流</label>
                                    <label><input type="checkbox" name="short-story-trope" value="系统"> 系统绑定</label>
                                    <label><input type="checkbox" name="short-story-trope" value="捞女"> 捞女</label>
                                    <label><input type="checkbox" name="short-story-trope" value="脚踏N条船"> 脚踏N条船</label>
                                    <label><input type="checkbox" name="short-story-trope" value="非典型小三"> 非典型小三</label>
                                    <label><input type="checkbox" name="short-story-trope" value="天生犟种"> 天生犟种</label>
                                    <label><input type="checkbox" name="short-story-trope" value="坏种"> 坏种</label>
                                    <label><input type="checkbox" name="short-story-trope" value="反驳型人格"> 反驳型人格</label>
                                    <label><input type="checkbox" name="short-story-trope" value="大女主爽文"> 大女主爽文</label>
                                    <label><input type="checkbox" name="short-story-trope" value="虐渣打脸"> 虐渣打脸</label>
                                    <label><input type="checkbox" name="short-story-trope" value="甜宠"> 甜宠</label>
                                    <label><input type="checkbox" name="short-story-trope" value="三观正"> 三观正</label>
                                    <label><input type="checkbox" name="short-story-trope" value="肉香弥漫"> 肉香弥漫</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>文风设定 (可多选)</label>
                                <div class="checkbox-group" style="max-height: 120px; overflow-y: auto; border: 1px solid #e5e7eb; padding: 1rem; border-radius: 8px;">
                                    <label><input type="checkbox" name="short-story-style" value="轻松欢脱"> 轻松欢脱</label>
                                    <label><input type="checkbox" name="short-story-style" value="温馨治愈"> 温馨治愈</label>
                                    <label><input type="checkbox" name="short-story-style" value="甜萌"> 甜萌</label>
                                    <label><input type="checkbox" name="short-story-style" value="虐心"> 虐心</label>
                                    <label><input type="checkbox" name="short-story-style" value="暗黑"> 暗黑</label>
                                    <label><input type="checkbox" name="short-story-style" value="快节奏爽文"> 快节奏爽文</label>
                                    <label><input type="checkbox" name="short-story-style" value="慢热细腻"> 慢热细腻</label>
                                    <label><input type="checkbox" name="short-story-style" value="悬疑紧张"> 悬疑紧张</label>
                                    <label><input type="checkbox" name="short-story-style" value="诙谐幽默"> 诙谐幽默</label>
                                    <label><input type="checkbox" name="short-story-style" value="简练有力"> 简练有力</label>
                                    <label><input type="checkbox" name="short-story-style" value="华丽唯美"> 华丽唯美</label>
                                    <label><input type="checkbox" name="short-story-style" value="接地气"> 接地气</label>
                                    <label><input type="checkbox" name="short-story-style" value="文艺清新"> 文艺清新</label>
                                    <label><input type="checkbox" name="short-story-style" value="大女主霸气"> 大女主霸气</label>
                                    <label><input type="checkbox" name="short-story-style" value="写实深刻"> 写实深刻</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <div
                                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                    <label style="margin-bottom: 0;">故事灵感/简介 (可选)</label>
                                    <label
                                        style="font-size: 0.85rem; color: var(--primary-color); cursor: pointer; display: flex; align-items: center;">
                                        <input type="checkbox" id="short-story-batch-mode"
                                            style="margin-right: 0.5rem;">
                                        批量灵感模式 (一行一个灵感)
                                    </label>
                                </div>
                                <textarea id="short-story-summary" rows="3"
                                    placeholder="描述你的故事灵感,例如:一个都市白领发现自己的老公竟然是..."></textarea>
                                <p id="short-story-batch-hint"
                                    style="display: none; font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.4rem;">
                                    💡 批量模式下，系统将为每一行文字单独生成一篇完整的短故事。
                                </p>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>目标字数</label>
                                    <select id="short-story-words">
                                        <option value="8000">8000字 (微短篇)</option>
                                        <option value="15000">15000字 (短篇)</option>
                                        <option value="22000" selected>22000字 (标准短篇)</option>
                                        <option value="30000">30000字 (上限)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>章节数</label>
                                    <select id="short-story-chapters">
                                        <option value="5">5章</option>
                                        <option value="8" selected>8章</option>
                                        <option value="10">10章</option>
                                        <option value="15">15章</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>生成数量</label>
                                    <select id="short-story-count">
                                        <option value="1" selected>1篇 (单篇)</option>
                                        <option value="2">2篇 (批量)</option>
                                        <option value="3">3篇 (批量)</option>
                                        <option value="5">5篇 (批量)</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn btn-primary" onclick="generateShortStorySettings()">✨
                                    生成设定</button>
                                <button type="button" class="btn btn-success" onclick="startShortStoryOneClick()"
                                    style="background-color: #10b981; margin-left: 10px;">🚀 一键生成全书</button>
                            </div>
                        </form>
                    </div>

                    <!-- 步骤2: 生成设定 -->
                    <div id="short-story-step-2" class="step-content" style="display: none;">
                        <div class="step-header">
                            <h3>📚 第二步: 小说设定</h3>
                            <p>AI生成的短故事设定,含30字标题和极致人设</p>
                        </div>
                        <div id="short-story-settings-content" class="settings-content">
                            <div class="loading-state">
                                <p>⏳ AI正在创作中,请稍候...</p>
                            </div>
                        </div>
                        <div class="form-actions" id="short-story-step-2-actions" style="display: none;">
                            <button type="button" class="btn" onclick="goToShortStoryStep(1)">← 返回</button>
                            <button type="button" class="btn btn-primary" onclick="generateShortStoryOutline()">→
                                生成大纲</button>
                        </div>
                    </div>

                    <!-- 步骤3: 生成大纲 -->
                    <div id="short-story-step-3" class="step-content" style="display: none;">
                        <div class="step-header">
                            <h3>📋 第三步: 章节大纲</h3>
                            <p>紧凑节奏,黄金三章设计,每节设置钩子</p>
                        </div>
                        <div id="short-story-outline-content" class="outline-content">
                            <div class="loading-state">
                                <p>⏳ AI正在生成大纲,请稍候...</p>
                            </div>
                        </div>
                        <div class="form-actions" id="short-story-step-3-actions" style="display: none;">
                            <button type="button" class="btn" onclick="goToShortStoryStep(2)">← 返回</button>
                            <button type="button" class="btn btn-primary" onclick="generateShortStoryChapters()">→
                                生成章节</button>
                        </div>
                    </div>

                    <!-- 步骤4: 生成章节 -->
                    <div id="short-story-step-4" class="step-content" style="display: none;">
                        <div class="step-header">
                            <h3>📖 第四步: 章节内容</h3>
                            <p>开头100字直入主题,心理描写重点</p>
                        </div>
                        <div id="short-story-chapters-content" class="chapters-content">
                            <div class="loading-state">
                                <p>⏳ AI正在创作章节,请稍候...</p>
                            </div>
                        </div>
                        <div class="form-actions" id="short-story-step-4-actions" style="display: none;">
                            <button type="button" class="btn" onclick="goToShortStoryStep(3)">← 返回</button>
                            <button type="button" class="btn btn-primary" onclick="generateShortStoryNovel()">→
                                一键成文</button>
                        </div>
                    </div>

                    <!-- 步骤5: 一键成文 -->
                    <div id="short-story-step-5" class="step-content" style="display: none;">
                        <div class="step-header">
                            <h3>🎉 第五步: 完成</h3>
                            <p>您的短故事已生成完毕!</p>
                        </div>
                        <div id="short-story-result" class="novel-result">
                            <div class="loading-state">
                                <p>⏳ 正在整合成文,请稍候...</p>
                            </div>
                        </div>
                        <div class="form-actions" id="short-story-step-5-actions" style="display: none;">
                            <button type="button" class="btn" onclick="exportShortStory()">📥 导出小说</button>
                            <button type="button" class="btn btn-success" onclick="startShortStoryReview()">🔍
                                提交AI审稿</button>
                            <button type="button" class="btn btn-primary" onclick="resetShortStory()">🔄 重新创作</button>
                        </div>
                    </div>

                    <!-- 步骤6: AI审稿 -->
                    <div id="short-story-step-6" class="step-content" style="display: none;">
                        <div class="step-header">
                            <h3>🔍 第六步: AI 爆文审稿助手</h3>
                            <p>深度诊断小说结构与情绪曲线,助你直达S级</p>
                        </div>

                        <div id="short-story-review-content" class="review-content">
                            <!-- 审稿报告 -->
                            <div class="loading-state">
                                <p>⏳ AI主编正在深度审读中...</p>
                            </div>
                        </div>

                        <div class="form-actions" id="short-story-step-6-actions" style="display: none;">
                            <button type="button" class="btn" onclick="goToShortStoryStep(5)">← 查看原文</button>
                            <button type="button" class="btn btn-info" onclick="openManuscriptCompareView()">📊
                                深度对照预览</button>
                            <button type="button" class="btn btn-primary" onclick="showShortStoryRewriteModal()">✍️
                                根据建议修改</button>
                            <button type="button" class="btn btn-success" onclick="exportShortStory()">📥 导出最终稿</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 长故事助手标签页 -->
            <div id="tab-long-novel" class="tab-content" style="display: none;">
                <div class="long-novel-panel">
                    <!-- 项目列表视图 -->
                    <div id="long-novel-list-view">
                        <div class="panel-header">
                            <h2>📚 长故事助手 - 项目列表</h2>
                            <p class="panel-desc">管理您的超长篇创作项目</p>
                        </div>
                        <div class="manuscript-list-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>标题</th>
                                        <th>状态</th>
                                        <th>源稿件</th>
                                        <th>字数</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="long-novel-list">
                                    <!-- 动态加载 -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- 创作台视图 -->
                    <div id="long-novel-board-view" style="display: none; height: calc(100vh - 160px);">
                        <div class="board-header"
                            style="padding: 1rem; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <button class="btn btn-sm btn-secondary" onclick="showLongNovelList()">← 返回列表</button>
                                <h3 id="long-novel-title-inline" style="margin: 0;">📊 创作台</h3>
                                <span style="font-size: 0.9rem; color: var(--text-secondary);"
                                    id="long-novel-title-detail"></span>
                            </div>
                        </div>

                        <div class="board-body"
                            style="display: flex; flex: 1; overflow: hidden; height: calc(100% - 60px);">
                            <!-- 左侧：卷章导航 -->
                            <div class="long-novel-sidebar"
                                style="width: 280px; background: #f9fafb; border-right: 1px solid #e5e7eb; overflow-y: auto;">
                                <div style="padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                                    <h4 style="margin-bottom: 0.5rem;">📖 卷章目录</h4>
                                    <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                                        <button class="btn btn-sm btn-primary" style="flex:1;"
                                            onclick="expandNextVolume()">+ 扩展卷</button>
                                        <button class="btn btn-sm btn-secondary" onclick="copySelectedChapters()">📋
                                            批量复制</button>
                                    </div>
                                    <div class="view-mode-toggle"
                                        style="display: flex; background: #eee; border-radius: 4px; padding: 2px;">
                                        <button class="toggle-btn active" id="mode-chapter"
                                            onclick="switchLongNovelMode('chapter')"
                                            style="flex: 1; border: none; background: white; border-radius: 3px; cursor: pointer; padding: 4px; font-size: 0.8rem;">章节模式</button>
                                        <button class="toggle-btn" id="mode-fulltext"
                                            onclick="switchLongNovelMode('fulltext')"
                                            style="flex: 1; border: none; background: transparent; cursor: pointer; padding: 4px; font-size: 0.8rem;">全文浏览</button>
                                    </div>
                                </div>
                                <div id="long-novel-toc" class="toc-list">
                                    <!-- 动态生成目录 -->
                                </div>
                            </div>

                            <!-- 中间：写作区 / 全文浏览区 -->
                            <div class="long-novel-editor"
                                style="flex: 1; display: flex; flex-direction: column; overflow: hidden;">
                                <!-- 章节编辑模式 -->
                                <div id="long-novel-chapter-view"
                                    style="display: flex; flex-direction: column; height: 100%;">
                                    <div class="editor-header"
                                        style="padding: 1rem; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
                                        <h4 id="current-chapter-title" style="margin: 0;">选择章节开始写作</h4>
                                        <div class="editor-actions">
                                            <button class="btn btn-sm btn-success" onclick="generateLongChapter()">✨
                                                AI生成本章</button>
                                            <button class="btn btn-sm" onclick="saveLongChapter()">💾 保存</button>
                                        </div>
                                    </div>
                                    <div class="editor-content"
                                        style="flex: 1; padding: 1.5rem; overflow-y: auto; background: white;">
                                        <div id="current-chapter-content-display"
                                            style="white-space: pre-wrap; line-height: 1.8; color: #374151; min-height: 500px; outline: none;"
                                            contenteditable="true"></div>
                                    </div>
                                </div>

                                <!-- 全文浏览模式 -->
                                <div id="long-novel-fulltext-view"
                                    style="display: none; flex-direction: column; height: 100%;">
                                    <div class="editor-header"
                                        style="padding: 1rem; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
                                        <h4 style="margin: 0;">📖 全文合集</h4>
                                        <button class="btn btn-sm btn-primary" onclick="copyAllLongNovel()">📋
                                            复制全书</button>
                                    </div>
                                    <div id="long-novel-fulltext-content"
                                        style="flex: 1; padding: 2rem; overflow-y: auto; background: white; color: #333; line-height: 2;">
                                        <!-- 全文内容 -->
                                    </div>
                                </div>
                            </div>

                            <!-- 右侧：信息栏 (大纲/设定) -->
                            <div class="long-novel-info"
                                style="width: 300px; border-left: 1px solid #e5e7eb; background: #fff; overflow-y: auto; padding: 1rem;">
                                <div class="info-section">
                                    <h5>📌 本章大纲</h5>
                                    <p id="current-chapter-summary"
                                        style="font-size: 0.9rem; color: #6b7280; margin-top: 0.5rem;">暂无信息</p>
                                </div>
                                <div class="info-section" style="margin-top: 2rem;">
                                    <h5>⚡ 核心冲突</h5>
                                    <p id="current-chapter-conflict"
                                        style="font-size: 0.9rem; color: #6b7280; margin-top: 0.5rem;">暂无信息</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 仿写生成系统标签页 -->
            <div id="tab-imitation" class="tab-content" style="display: none;">
                <div class="imitation-container">
                    <h1>
                        <span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                            AI仿写生成系统
                        </span>
                    </h1>

                    <!-- 阶段一：深度拆解 -->
                    <div class="step-card" id="step1">
                        <div class="step-header">
                            <div class="step-number">1</div>
                            <div class="step-title">深度拆解原文</div>
                            <div class="step-status pending" id="step1-status">待开始</div>
                        </div>

                        <div class="form-group">
                            <label>原文标题</label>
                            <input type="text" id="original-title" placeholder="请输入原文标题">
                        </div>

                        <div class="form-group">
                            <label>原文内容</label>
                            <textarea id="original-content" placeholder="请粘贴要仿写的原文内容，或点击下方按钮上传文件/截图识别"></textarea>
                        </div>

                        <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                            <button type="button" class="btn btn-secondary" onclick="uploadFile()">📁 上传文件</button>
                            <button type="button" class="btn btn-secondary" onclick="uploadImage()">📷 上传截图识别</button>
                            <button type="button" class="btn btn-primary" id="btn-deconstruct" onclick="deconstructOriginal()">
                                开始拆解
                            </button>
                        </div>

                        <input type="file" id="file-input" accept=".txt,.md" style="display: none;" onchange="handleFileUpload(event)">
                        <input type="file" id="image-input" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">

                        <!-- 图片预览 -->
                        <div id="image-preview-container" class="hidden" style="margin-top: 16px; text-align: center;">
                            <img id="image-preview" style="max-width: 100%; max-height: 400px; border-radius: 8px; border: 1px solid #ddd;">
                            <p id="ocr-status" style="margin-top: 8px; color: #666;">正在识别图片中的文字...</p>
                        </div>

                        <div class="analysis-result hidden" id="deconstruction-result">
                            <h4>拆解结果</h4>
                            <pre id="deconstruction-json"></pre>
                        </div>
                    </div>

                    <!-- 阶段二：配置新设定 -->
                    <div class="step-card" id="step2">
                        <div class="step-header">
                            <div class="step-number">2</div>
                            <div class="step-title">配置新设定</div>
                            <div class="step-status pending" id="step2-status">待开始</div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>新世界观</label>
                                <select id="new-worldview">
                                    <option value="都市">都市</option>
                                    <option value="玄幻">玄幻</option>
                                    <option value="科幻">科幻</option>
                                    <option value="末世">末世</option>
                                    <option value="历史">历史</option>
                                    <option value="游戏">游戏</option>
                                    <option value="灵异">灵异</option>
                                    <option value="其他">其他</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>核心冲突</label>
                                <input type="text" id="core-conflict" placeholder="例如：裁员、退婚、背叛、夺权...">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>主角人设</label>
                            <div class="form-row">
                                <input type="text" id="protagonist-name" placeholder="主角姓名">
                                <input type="text" id="protagonist-identity" placeholder="身份（例如：35岁P7技术专家）">
                            </div>
                            <div class="form-row" style="margin-top: 12px;">
                                <input type="text" id="protagonist-personality" placeholder="性格特点">
                                <input type="text" id="protagonist-motivation" placeholder="核心动机">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>金手指/外挂设定</label>
                            <input type="text" id="golden-finger" placeholder="例如：AI辅助系统、重生、系统...">
                        </div>

                        <button type="button" class="btn btn-primary" id="btn-configure" onclick="configureImitation()">
                            确认配置
                        </button>
                    </div>

                    <!-- 阶段三：重构蓝图预览 -->
                    <div class="step-card" id="step3">
                        <div class="step-header">
                            <div class="step-number">3</div>
                            <div class="step-title">重构蓝图预览</div>
                            <div class="step-status pending" id="step3-status">待开始</div>
                        </div>

                        <p style="color: #666; margin-bottom: 16px;">
                            点击下方按钮，AI将基于拆解结果和新设定，生成原情节与新情节的对照表。
                        </p>

                        <button type="button" class="btn btn-primary" id="btn-preview" onclick="previewReconstruction()">
                            生成重构蓝图
                        </button>

                        <div class="analysis-result hidden" id="blueprint-result">
                            <h4>原情节 vs 新情节 对照表</h4>
                            <div id="blueprint-table-container"></div>
                        </div>
                    </div>

                    <!-- 阶段四：生成仿写正文 -->
                    <div class="step-card" id="step4">
                        <div class="step-header">
                            <div class="step-number">4</div>
                            <div class="step-title">生成仿写正文</div>
                            <div class="step-status pending" id="step4-status">待开始</div>
                        </div>

                        <p style="color: #666; margin-bottom: 16px;">
                            点击下方按钮，AI将基于重构蓝图生成完整的仿写正文。
                        </p>

                        <button type="button" class="btn btn-primary" id="btn-generate" onclick="generateImitation()">
                            开始生成
                        </button>

                        <div class="generated-content hidden" id="generated-result"></div>
                    </div>
                </div>
            </div>

            <!-- 批量生成标签页 -->
            <div id="tab-batch-generation" class="tab-content" style="display: none;">
                <div class="batch-generation-container">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h2 style="font-size: 2rem; font-weight: 700; margin-bottom: 10px;">
                            <span style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                                🚀 批量生成系统
                            </span>
                        </h2>
                        <p style="color: #666;">同时生成多篇不同设定的文章，效率提升3-4倍！</p>
                    </div>

                    <!-- 快速创建批量任务 -->
                    <div class="panel-card" style="background: white; border-radius: 12px; padding: 24px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <h3 style="margin-bottom: 20px;">⚡ 快速批量生成</h3>

                        <div class="form-group">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500;">任务名称</label>
                            <input type="text" id="batch-task-name" placeholder="例如：我的第一波批量测试" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
                        </div>

                        <div class="form-group">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500;">故事创意（所有文章共用）</label>
                            <textarea id="batch-summary" rows="4" placeholder="描述你的故事创意，例如：一个关于时间旅行的故事，主角意外获得了一个能够回到过去的手表..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; resize: vertical;"></textarea>
                        </div>

                        <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 500;">章节数</label>
                                <input type="number" id="batch-chapter-count" value="8" min="1" max="20" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 500;">目标字数</label>
                                <input type="number" id="batch-target-words" value="22000" step="1000" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px;">
                            </div>
                        </div>

                        <div class="form-group">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500;">选择要生成的题材（可多选）</label>
                            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; margin-bottom: 16px;">
                                <label style="display: flex; align-items: center; padding: 8px; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; transition: all 0.2s;">
                                    <input type="checkbox" class="batch-genre-checkbox" value="甜宠" style="margin-right: 8px;"> 甜宠
                                </label>
                                <label style="display: flex; align-items: center; padding: 8px; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; transition: all 0.2s;">
                                    <input type="checkbox" class="batch-genre-checkbox" value="悬疑" style="margin-right: 8px;"> 悬疑
                                </label>
                                <label style="display: flex; align-items: center; padding: 8px; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; transition: all 0.2s;">
                                    <input type="checkbox" class="batch-genre-checkbox" value="大女主" style="margin-right: 8px;"> 大女主
                                </label>
                                <label style="display: flex; align-items: center; padding: 8px; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; transition: all 0.2s;">
                                    <input type="checkbox" class="batch-genre-checkbox" value="科幻" style="margin-right: 8px;"> 科幻
                                </label>
                                <label style="display: flex; align-items: center; padding: 8px; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; transition: all 0.2s;">
                                    <input type="checkbox" class="batch-genre-checkbox" value="末世" style="margin-right: 8px;"> 末世
                                </label>
                                <label style="display: flex; align-items: center; padding: 8px; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; transition: all 0.2s;">
                                    <input type="checkbox" class="batch-genre-checkbox" value="复仇" style="margin-right: 8px;"> 复仇
                                </label>
                                <label style="display: flex; align-items: center; padding: 8px; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; transition: all 0.2s;">
                                    <input type="checkbox" class="batch-genre-checkbox" value="脑洞" style="margin-right: 8px;"> 脑洞
                                </label>
                                <label style="display: flex; align-items: center; padding: 8px; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; transition: all 0.2s;">
                                    <input type="checkbox" class="batch-genre-checkbox" value="仙侠" style="margin-right: 8px;"> 仙侠
                                </label>
                            </div>
                        </div>

                        <div style="text-align: center;">
                            <button type="button" class="btn btn-primary" id="btn-start-batch" onclick="startBatchGeneration()" style="padding: 14px 40px; font-size: 16px;">
                                🚀 开始批量生成
                            </button>
                            <p style="margin-top: 12px; color: #666; font-size: 14px;">
                                <span id="selected-genres-count">已选择 0 个题材</span>
                            </p>
                        </div>
                    </div>

                    <!-- 当前批量任务状态 -->
                    <div id="current-batch-task-panel" class="panel-card hidden" style="background: white; border-radius: 12px; padding: 24px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <h3 style="margin-bottom: 20px;">📊 当前任务进度</h3>

                        <div id="batch-progress-section">
                            <div style="margin-bottom: 16px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                    <span style="font-weight: 500;">总体进度</span>
                                    <span id="batch-progress-text">0%</span>
                                </div>
                                <div style="width: 100%; height: 20px; background: #f0f0f0; border-radius: 10px; overflow: hidden;">
                                    <div id="batch-progress-bar" style="width: 0%; height: 100%; background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%); transition: width 0.5s;"></div>
                                </div>
                            </div>

                            <div id="batch-status-text" style="color: #666; margin-bottom: 16px;">等待开始...</div>

                            <div style="display: flex; gap: 12px;">
                                <button type="button" class="btn btn-secondary" onclick="refreshBatchProgress()" style="flex: 1;">🔄 刷新进度</button>
                                <button type="button" class="btn btn-secondary" onclick="cancelBatchTask()" style="flex: 1;">⏹ 取消任务</button>
                            </div>
                        </div>
                    </div>

                    <!-- 子任务列表 -->
                    <div id="sub-tasks-panel" class="panel-card hidden" style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <h3 style="margin-bottom: 20px;">📝 生成任务列表</h3>

                        <div id="sub-tasks-list">
                            <!-- 动态生成 -->
                        </div>
                    </div>

                    <!-- 历史批量任务 -->
                    <div class="panel-card" style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <h3 style="margin-bottom: 20px;">📚 历史批量任务</h3>

                        <div style="margin-bottom: 16px;">
                            <button type="button" class="btn btn-secondary" onclick="loadBatchTasksList()">🔄 刷新列表</button>
                        </div>

                        <div id="batch-tasks-history">
                            <p style="color: #999; text-align: center; padding: 20px;">暂无历史任务</p>
                        </div>
                    </div>
                </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    </div>







    <!-- 稿件历史模态框 -->
    <div id="manuscript-history-modal" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>📚 我的短故事稿件</h3>
                <button class="modal-close" onclick="closeManuscriptHistoryModal()">✕</button>
            </div>
            <div class="modal-body">
                <div class="manuscript-list-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>标题</th>
                                <th>状态</th>
                                <th>评级</th>
                                <th>创建时间</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="manuscript-history-list">
                            <!-- 动态加载 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>


    <!-- 稿件对照预览模态框 -->
    <div id="manuscript-review-modal" class="modal" style="display: none;">
        <div class="modal-content modal-fullscreen">
            <div class="modal-header">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <h3>📊 深度对照预览</h3>
                    <span class="badge" id="manuscript-grade-badge"
                        style="font-size: 1.2rem; font-weight: bold;"></span>
                    <span style="font-size: 0.9rem; color: var(--text-secondary);" id="manuscript-time"></span>
                </div>
                <button class="modal-close" onclick="closeManuscriptReviewModal()">✕</button>
            </div>
            <div class="modal-body" style="padding: 0; overflow: hidden; height: calc(100% - 60px);">
                <div class="split-view-container">
                    <!-- 左侧：原文 -->
                    <div class="split-pane left-pane">
                        <div class="pane-header">
                            <h4>📄 原文内容</h4>
                            <div class="pane-actions">
                                <button class="btn btn-sm" onclick="toggleEditMode()">✏️ 编辑</button>
                            </div>
                        </div>
                        <div class="pane-content" id="manuscript-original-content">
                            <!-- 原文内容 -->
                        </div>
                    </div>

                    <!-- 右侧：审稿报告 -->
                    <div class="split-pane right-pane">
                        <div class="pane-header">
                            <h4>🔍 审稿诊断 & 建议</h4>
                            <div class="pane-actions">
                                <button class="btn btn-sm btn-primary" onclick="showShortStoryRewriteModal()">✨
                                    AI重写</button>
                            </div>
                        </div>
                        <div class="pane-content review-report-style" id="manuscript-review-content">
                            <!-- 审稿报告 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- 投稿详情模态框 -->
    <div id="submission-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">新建投稿</h3>
                <button class="modal-close" onclick="closeSubmissionModal()">✕</button>
            </div>
            <div class="modal-body">
                <form id="submission-form">
                    <input type="hidden" id="submission-id">

                    <div class="form-group">
                        <label>选择项目</label>
                        <select id="submission-project" required>
                            <option value="">请选择项目</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>投稿平台</label>
                        <select id="submission-platform" required>
                            <option value="番茄">番茄</option>
                            <option value="七猫">七猫</option>
                            <option value="灯下">灯下</option>
                            <option value="风行故事会">风行故事会</option>
                            <option value="墨墨言情">墨墨言情</option>
                            <option value="爆米花">爆米花</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>笔名</label>
                        <input type="text" id="submission-penname" value="鱼头" required>
                    </div>

                    <div class="form-group">
                        <label>书名</label>
                        <input type="text" id="submission-bookname" placeholder="输入书名" required>
                    </div>

                    <div class="form-group">
                        <label>主题</label>
                        <input type="text" id="submission-theme" placeholder="例如：追妻火葬场" required>
                    </div>

                    <div class="form-group">
                        <label>投稿状态</label>
                        <select id="submission-status">
                            <option value="pending">待投稿</option>
                            <option value="submitted">已投稿</option>
                            <option value="under_review">审核中</option>
                            <option value="approved">已通过</option>
                            <option value="rejected">已拒绝</option>
                            <option value="published">已发布</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>投稿日期</label>
                        <input type="date" id="submission-date">
                    </div>

                    <div class="form-group">
                        <label>备注</label>
                        <textarea id="submission-notes" rows="3" placeholder="备注信息..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="auto-generate" checked>
                            自动生成投稿标题和导语
                        </label>
                    </div>

                    <div id="generated-content" style="display: none;">
                        <div class="form-group">
                            <label>投稿标题（自动生成）</label>
                            <textarea id="submission-title" rows="2" readonly></textarea>
                            <button type="button" class="btn btn-sm btn-secondary"
                                onclick="copySubmissionTitle()">复制标题</button>
                        </div>

                        <div class="form-group">
                            <label>邮件导语（自动生成）</label>
                            <textarea id="submission-intro" rows="5" readonly></textarea>
                            <button type="button" class="btn btn-sm btn-secondary"
                                onclick="copySubmissionIntro()">复制导语</button>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeSubmissionModal()">取消</button>
                        <button type="submit" class="btn btn-primary">保存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 渠道智能体创建/编辑模态框 -->
    <div id="channel-agent-modal" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="channel-agent-modal-title">创建渠道智能体</h3>
                <button class="modal-close" onclick="closeChannelAgentModal()">✕</button>
            </div>
            <div class="modal-body">
                <form id="channel-agent-form">
                    <input type="hidden" id="channel-agent-id">

                    <!-- 基本信息 -->
                    <div class="form-section">
                        <h4>📋 基本信息</h4>
                        <div class="form-group">
                            <label>智能体名称 <span class="required">*</span></label>
                            <input type="text" id="channel-agent-name" placeholder="例如：武志红公众号" required>
                        </div>

                        <div class="form-group">
                            <label>描述</label>
                            <textarea id="channel-agent-description" rows="2" placeholder="描述这个智能体的用途..."></textarea>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>渠道类型</label>
                                <select id="channel-agent-type">
                                    <option value="emotion">💕 情感</option>
                                    <option value="story">📖 故事</option>
                                    <option value="parenting">👶 育儿</option>
                                    <option value="career">💼 职场</option>
                                    <option value="psychology">🧠 心理</option>
                                    <option value="general">📝 通用</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>目标受众</label>
                                <input type="text" id="channel-agent-audience" placeholder="例如：25-35岁都市女性">
                            </div>
                        </div>
                    </div>

                    <!-- 渠道特点 -->
                    <div class="form-section">
                        <h4>🎯 渠道特点</h4>
                        <div class="form-group">
                            <label>擅长话题</label>
                            <textarea id="channel-agent-topics" rows="2"
                                placeholder="例如：亲密关系,情感问题,婚姻经营,自我成长"></textarea>
                        </div>

                        <div class="form-group">
                            <label>文风要求</label>
                            <input type="text" id="channel-agent-tone" placeholder="例如：温暖、共情、细腻">
                        </div>

                        <div class="form-group">
                            <label>字数要求</label>
                            <div class="form-row">
                                <input type="number" id="channel-agent-min-words" placeholder="最小字数">
                                <input type="number" id="channel-agent-max-words" placeholder="最大字数">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>特殊要求</label>
                            <textarea id="channel-agent-requirements" rows="2"
                                placeholder="例如：需要有真实案例,避免说教..."></textarea>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeChannelAgentModal()">取消</button>
                        <button type="submit" class="btn btn-primary">保存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 语料上传模态框 -->
    <div id="corpus-upload-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>📤 上传训练语料</h3>
                <button class="modal-close" onclick="closeCorpusUploadModal()">✕</button>
            </div>
            <div class="modal-body">
                <form id="corpus-upload-form">
                    <input type="hidden" id="corpus-agent-id">

                    <div class="form-group">
                        <label>选择智能体</label>
                        <input type="text" id="corpus-agent-name" readonly style="background: #f5f5f5;">
                    </div>

                    <div class="form-group">
                        <label>上传语料文件 (.txt / .md)</label>
                        <div class="file-upload-area" id="corpus-drop-zone">
                            <input type="file" id="corpus-files" accept=".txt,.md,text/markdown,text/plain" multiple
                                style="display: none;">
                            <div class="upload-prompt">
                                <p>📁 拖拽文件到此处或点击上传</p>
                                <p class="upload-hint">支持多个.txt和.md文件，建议上传10-50篇该渠道的范文</p>
                            </div>
                            <div id="corpus-file-list" class="file-list"></div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeCorpusUploadModal()">取消</button>
                        <button type="submit" class="btn btn-primary">开始训练</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 内容生成模态框 -->
    <div id="content-generate-modal" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>✨ 生成投稿内容</h3>
                <button class="modal-close" onclick="closeGenerateModal()">✕</button>
            </div>
            <div class="modal-body">
                <form id="content-generate-form">
                    <input type="hidden" id="generate-agent-id">

                    <div class="form-group">
                        <label>使用智能体</label>
                        <input type="text" id="generate-agent-name" readonly style="background: #f5f5f5;">
                    </div>

                    <div class="form-group">
                        <label>文章主题（可选）</label>
                        <textarea id="generate-topic" rows="2" placeholder="留空则由AI根据渠道风格自主推荐主题，也可以输入你想写的主题"></textarea>
                        <p style="font-size: 0.85rem; color: #64748b; margin-top: 0.25rem;">💡
                            建议留空，让AI根据该渠道的风格自主创作更合适的主题</p>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>目标项目</label>
                            <select id="generate-project" onchange="handleProjectSelectChange()">
                                <option value="">不保存到项目</option>
                                <option value="__new__">+ 新建项目</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>字数</label>
                            <input type="number" id="generate-word-count" placeholder="自动">
                        </div>
                    </div>

                    <!-- 新建项目表单（默认隐藏） -->
                    <div id="new-project-form"
                        style="display: none; background: #f0f9ff; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid #0ea5e9;">
                        <div class="form-group">
                            <label>新项目名称 <span class="required">*</span></label>
                            <input type="text" id="new-project-name" placeholder="输入新项目名称" style="background: white;">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>额外要求</label>
                        <textarea id="generate-requirements" rows="2" placeholder="例如：需要包含具体的对话场景，要有反转..."></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeGenerateModal()">取消</button>
                        <button type="button" class="btn btn-info" onclick="generateInspiration()"
                            id="generate-inspiration-btn">💡 AI生成灵感</button>
                        <button type="button" class="btn btn-success" onclick="generateContent()"
                            id="generate-content-btn" disabled>✍️ AI生成内容</button>
                    </div>
                </form>

                <!-- 灵感编辑区域 -->
                <div id="inspiration-editor" style="display: none; margin-top: 1.5rem;">
                    <div class="form-section"
                        style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); padding: 1.5rem; border-radius: 12px; border-left: 4px solid #0ea5e9;">
                        <h4 style="margin: 0 0 1rem 0; color: #0369a1;">💡 AI生成的灵感</h4>

                        <div class="form-group">
                            <label>推荐主题</label>
                            <div id="inspiration-topic"
                                style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 1rem; border-radius: 8px; margin-bottom: 0.5rem; border-left: 4px solid #f59e0b; font-weight: 500; color: #92400e;">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>标题建议</label>
                            <div id="inspiration-titles"
                                style="background: white; padding: 0.75rem; border-radius: 8px; margin-bottom: 0.5rem;">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>核心角度</label>
                            <textarea id="inspiration-angle" rows="2" style="background: white;"></textarea>
                        </div>

                        <div class="form-group">
                            <label>内容大纲</label>
                            <textarea id="inspiration-outline" rows="6" style="background: white;"></textarea>
                        </div>

                        <div class="form-group">
                            <label>关键元素</label>
                            <input type="text" id="inspiration-elements" style="background: white;">
                        </div>

                        <div class="form-group">
                            <label>情绪弧线</label>
                            <textarea id="inspiration-emotional" rows="2" style="background: white;"></textarea>
                        </div>

                        <div class="form-group">
                            <label>创作要点</label>
                            <textarea id="inspiration-notes" rows="2" style="background: white;"></textarea>
                        </div>

                        <div class="form-actions" style="margin-top: 1rem;">
                            <button type="button" class="btn btn-secondary" onclick="regenerateInspiration()">🔄
                                重新生成灵感</button>
                            <button type="button" class="btn btn-success" onclick="confirmInspiration()">✅
                                确认并生成内容</button>
                        </div>
                    </div>
                </div>

                <!-- 生成进度提示 -->
                <div id="generation-progress"
                    style="display: none; margin-top: 1.5rem; padding: 1.5rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white; text-align: center;">
                    <div style="font-size: 3rem; margin-bottom: 1rem; animation: pulse 1.5s infinite;">✨</div>
                    <h4 style="margin: 0 0 0.5rem 0; font-size: 1.1rem;" id="progress-title">AI正在创作中...</h4>
                    <p style="margin: 0.5rem 0; opacity: 0.9; font-size: 0.9rem;" id="generation-progress-text">
                        正在分析主题和风格要求</p>
                    <div
                        style="margin-top: 1rem; background: rgba(255,255,255,0.2); height: 6px; border-radius: 3px; overflow: hidden;">
                        <div id="generation-progress-bar"
                            style="height: 100%; background: white; border-radius: 3px; transition: width 0.5s ease; width: 0%;">
                        </div>
                    </div>
                    <p style="margin: 0.8rem 0 0 0; opacity: 0.8; font-size: 0.85rem;" id="progress-time">预计需要
                        30-60 秒，请稍候...</p>
                </div>

                <!-- 生成结果 -->
                <div id="generation-result" style="display: none; margin-top: 1.5rem;">
                    <div class="form-section">
                        <h4>📝 生成内容</h4>
                        <div id="generated-content-display"
                            style="background: #f8fafc; padding: 1rem; border-radius: 8px; max-height: 400px; overflow-y: auto; white-space: pre-wrap; line-height: 1.8;">
                        </div>
                        <div class="form-actions" style="margin-top: 1rem;">
                            <button type="button" class="btn btn-secondary" onclick="copyGeneratedContent()">📋
                                复制内容</button>
                            <button type="button" class="btn btn-primary" onclick="saveToProject()">💾
                                保存到项目</button>
                            <button type="button" class="btn btn-secondary" onclick="regenerateContent()">🔄
                                重新生成</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    </main>


    <!-- 稿件审阅对照弹窗 (分屏版) -->
    <div id="manuscript-review-modal" class="modal" style="display: none;">
        <div class="modal-content"
            style="max-width: 1200px; width: 95%; height: 90vh; display: flex; flex-direction: column;">
            <div class="modal-header">
                <h3>📖 稿件深度审阅 - 对照视图</h3>
                <button class="modal-close" onclick="closeManuscriptReviewModal()">✕</button>
            </div>
            <div class="modal-body" style="flex: 1; overflow: hidden; display: flex; padding: 0;">
                <div class="review-split-container" style="display: flex; width: 100%; height: 100%;">
                    <!-- 左侧：原文 -->
                    <div class="review-pane left-pane"
                        style="flex: 1; overflow-y: auto; padding: 1.5rem; border-right: 1px solid var(--border-color); background: #fdfdfd;">
                        <h4
                            style="margin-bottom: 1rem; color: var(--text-secondary); display: flex; align-items: center; gap: 8px;">
                            <span
                                style="background: var(--primary-color); width: 4px; height: 16px; border-radius: 2px;"></span>
                            小说正文原文
                        </h4>
                        <div id="manuscript-original-content"
                            style="line-height: 1.8; font-size: 1rem; color: #334155; white-space: pre-wrap;">
                            <!-- 这里加载正文内容 -->
                        </div>
                    </div>
                    <!-- 右侧：审稿报告 -->
                    <div class="review-pane right-pane"
                        style="flex: 1; overflow-y: auto; padding: 1.5rem; background: #fffaf0;">
                        <h4
                            style="margin-bottom: 1rem; color: var(--text-secondary); display: flex; align-items: center; gap: 8px;">
                            <span style="background: #f59e0b; width: 4px; height: 16px; border-radius: 2px;"></span>
                            AI 主编审稿报告
                        </h4>
                        <div id="manuscript-review-content" style="line-height: 1.6;">
                            <!-- 这里加载审稿报告 (Markdown) -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer"
                style="padding: 1rem; border-top: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
                <div class="manuscript-info" style="font-size: 0.85rem; color: var(--text-secondary);">
                    <span>版本生成时间: <span id="manuscript-time">-</span></span>
                    <span style="margin-left: 1rem;">评分: <span id="manuscript-grade-badge"
                            style="font-weight: bold; color: #f59e0b;">-</span></span>
                </div>
                <div class="actions">
                    <button class="btn btn-secondary" onclick="closeManuscriptReviewModal()">关闭预览</button>
                    <button class="btn btn-primary" onclick="showShortStoryRewriteModal()">✍️ 根据建议修改</button>
                </div>
            </div>
        </div>
    </div>


    <!-- 短故事重写弹窗 -->
    <div id="short-story-rewrite-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>✍️ 优化重构建议</h3>
                <button class="modal-close" onclick="closeShortStoryRewriteModal()">✕</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 1rem; font-size: 0.9rem; color: var(--text-secondary);">
                    AI将根据审稿报告调整故事结构。你也可以添加额外的修改要求：
                </p>
                <textarea id="short-story-rewrite-instruction" rows="4"
                    placeholder="例如：稍微增加一点甜宠戏份 / 把第二章的冲突写得再剧烈一点... (可选)"
                    style="width: 100%; padding: 0.8rem; border-radius: 8px; border: 1px solid var(--border-color);"></textarea>
            </div>
            <div class="modal-footer"
                style="padding: 1rem; border-top: 1px solid var(--border-color); display: flex; justify-content: flex-end; gap: 10px;">
                <button class="btn btn-secondary" onclick="closeShortStoryRewriteModal()">取消</button>
                <button class="btn btn-primary" onclick="executeShortStoryRewrite()">🚀 开始重构</button>
            </div>
        </div>
    </div>

    <script src="/static/js/short-story.js?v=9"></script>
    <script src="/static/js/long-novel.js?v=1"></script>
    <script src="/static/js/imitation.js?v=1"></script>
    <script src="/static/js/batch-generation.js?v=1"></script>
    <script src="/static/js/app.js?v=9"></script>
</body>

</html>