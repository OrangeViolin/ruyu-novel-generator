<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>如鱼写作 - 如鱼得水，丝滑创作</title>
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><defs><linearGradient id='grad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' style='stop-color:%236366f1'/><stop offset='100%' style='stop-color:%234f46e5'/></linearGradient></defs><rect width='32' height='32' rx='6' fill='url(%23grad)'/><text x='16' y='22' font-family='Arial' font-size='18' font-weight='bold' fill='white' text-anchor='middle'>✍️</text></svg>">
    <link rel="stylesheet" href="/static/css/style.css?v=9">
</head>

<body>
    <div id="app">
        <!-- 顶部导航 -->
        <nav class="navbar">
            <div class="nav-brand">
                <img src="/static/assets/logo.png" alt="如鱼写作" class="logo">
                <div class="brand-text">
                    <h1>如鱼写作</h1>
                    <span class="brand-slogan">如鱼得水，丝滑创作</span>
                </div>
            </div>
            <div class="nav-links">
                <button class="nav-btn" data-tab="short-story">📝 短故事助手</button>
                <button class="nav-btn" data-tab="inspiration">💡 创作灵感助手</button>
            </div>
        </nav>

        <!-- 主内容区 -->
        <main class="main-content">
            <!-- 灵感鱼缸 (Floating Bubbles) -->
            <aside id="inspiration-aquarium" class="aquarium">
                <div class="aquarium-header">
                    <h4>🐟 灵感鱼缸</h4>
                    <p>点击气泡喂入灵感</p>
                </div>
                <div id="bubble-container" class="bubble-container">
                    <!-- 气泡将由JS动态生成 -->
                </div>
            </aside>


            <!-- 创作灵感助手标签页 -->
            <div id="tab-inspiration" class="tab-content">
                <div class="inspiration-panel">
                    <div class="panel-header">
                        <h2>💡 创作灵感助手</h2>
                        <p class="panel-desc">从灵感到成文,五步完成小说创作</p>
                    </div>

                    <!-- 步骤指示器 -->
                    <div class="step-indicator">
                        <div class="step active" data-step="1">
                            <div class="step-number">1</div>
                            <div class="step-label">灵感收集</div>
                        </div>
                        <div class="step-arrow">→</div>
                        <div class="step" data-step="2">
                            <div class="step-number">2</div>
                            <div class="step-label">生成设定</div>
                        </div>
                        <div class="step-arrow">→</div>
                        <div class="step" data-step="3">
                            <div class="step-number">3</div>
                            <div class="step-label">生成大纲</div>
                        </div>
                        <div class="step-arrow">→</div>
                        <div class="step" data-step="4">
                            <div class="step-number">4</div>
                            <div class="step-label">生成细章</div>
                        </div>
                        <div class="step-arrow">→</div>
                        <div class="step" data-step="5">
                            <div class="step-number">5</div>
                            <div class="step-label">一键成文</div>
                        </div>
                    </div>

                    <!-- 步骤1: 灵感收集 -->
                    <div id="inspiration-step-1" class="step-content active">
                        <div class="step-header">
                            <h3>📝 第一步: 灵感收集</h3>
                            <p>填写您的初步想法,留空将由AI随机生成</p>
                        </div>
                        <form id="inspiration-form" class="inspiration-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>故事简介</label>
                                    <textarea id="inspiration-summary" rows="3"
                                        placeholder="例如:一个现代都市女性穿越到古代成为公主的故事..."></textarea>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>目标读者</label>
                                    <select id="inspiration-readers">
                                        <option value="">AI随机生成</option>
                                        <option value="young">青少年 (12-18岁)</option>
                                        <option value="young_adult">年轻成人 (18-30岁)</option>
                                        <option value="adult">成人 (30-50岁)</option>
                                        <option value="all">全年龄</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>小说类型</label>
                                    <select id="inspiration-genre">
                                        <option value="">AI随机生成</option>
                                        <option value="romance">言情小说</option>
                                        <option value="fantasy">玄幻小说</option>
                                        <option value="urban">都市小说</option>
                                        <option value="historical">历史小说</option>
                                        <option value="scifi">科幻小说</option>
                                        <option value="mystery">悬疑小说</option>
                                        <option value="wuxia">武侠小说</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>章节数量</label>
                                    <select id="inspiration-chapters">
                                        <option value="">AI随机生成</option>
                                        <option value="5">5章 (短篇)</option>
                                        <option value="10">10章 (中短篇)</option>
                                        <option value="20">20章 (中篇)</option>
                                        <option value="30">30章 (长篇)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>目标字数</label>
                                    <select id="inspiration-words">
                                        <option value="">AI随机生成</option>
                                        <option value="5000">5000字 (微短篇)</option>
                                        <option value="10000">10000字 (短篇)</option>
                                        <option value="30000">30000字 (中篇)</option>
                                        <option value="50000">50000字 (长篇)</option>
                                        <option value="100000">100000字 (超长篇)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>写作元素建议 (可选,多个用逗号分隔)</label>
                                <input type="text" id="inspiration-elements" placeholder="例如:重生,复仇,豪门恩怨,身份错位...">
                            </div>
                            <div class="form-actions">
                                <button type="button" class="btn btn-primary" onclick="generateInpiration()">✨
                                    AI生成设定</button>
                                <button type="button" class="btn btn-success" onclick="startOneClickGeneration()"
                                    style="background-color: #10b981; margin-left: 10px;">🚀 一键生成全书</button>
                            </div>
                        </form>
                    </div>

                    <!-- 步骤2: 生成设定 -->
                    <div id="inspiration-step-2" class="step-content" style="display: none;">
                        <div class="step-header">
                            <h3>📚 第二步: 小说设定</h3>
                            <p>AI为您生成的完整小说设定,可编辑修改</p>
                        </div>
                        <div id="settings-content" class="settings-content">
                            <div class="loading-state">
                                <p>⏳ AI正在创作中,请稍候...</p>
                            </div>
                        </div>
                        <div class="form-actions" id="step-2-actions" style="display: none;">
                            <button type="button" class="btn" onclick="backToStep(1)">← 返回上一步</button>
                            <button type="button" class="btn btn-primary" onclick="generateOutline()">→ 生成大纲</button>
                        </div>
                    </div>

                    <!-- 步骤3: 生成大纲 -->
                    <div id="inspiration-step-3" class="step-content" style="display: none;">
                        <div class="step-header">
                            <h3>📋 第三步: 章节大纲</h3>
                            <p>基于设定生成的详细章节大纲</p>
                        </div>
                        <div id="outline-content" class="outline-content">
                            <div class="loading-state">
                                <p>⏳ AI正在生成大纲,请稍候...</p>
                            </div>
                        </div>
                        <div class="form-actions" id="step-3-actions" style="display: none;">
                            <button type="button" class="btn" onclick="backToStep(2)">← 返回上一步</button>
                            <button type="button" class="btn btn-primary" onclick="generateChapters()">→ 生成细章</button>
                        </div>
                    </div>

                    <!-- 步骤4: 生成细章 -->
                    <div id="inspiration-step-4" class="step-content" style="display: none;">
                        <div class="step-header">
                            <h3>📖 第四步: 章节内容</h3>
                            <p>基于大纲生成的完整章节内容</p>
                        </div>
                        <div id="chapters-content" class="chapters-content">
                            <div class="loading-state">
                                <p>⏳ AI正在创作章节,请稍候...</p>
                            </div>
                        </div>
                        <div class="form-actions" id="step-4-actions" style="display: none;">
                            <button type="button" class="btn" onclick="backToStep(3)">← 返回上一步</button>
                            <button type="button" class="btn btn-primary" onclick="generateNovel()">→ 一键成文</button>
                        </div>
                    </div>

                    <!-- 步骤5: 一键成文 -->
                    <div id="inspiration-step-5" class="step-content" style="display: none;">
                        <div class="step-header">
                            <h3>🎉 第五步: 完成</h3>
                            <p>您的小说已生成完毕!</p>
                        </div>
                        <div id="novel-result" class="novel-result">
                            <div class="loading-state">
                                <p>⏳ 正在整合成文,请稍候...</p>
                            </div>
                        </div>
                        <div class="form-actions" id="step-5-actions" style="display: none;">
                            <button type="button" class="btn" onclick="exportNovel()">📥 导出小说</button>
                            <button type="button" class="btn btn-primary" onclick="resetInspiration()">🔄 重新创作</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 短故事助手标签页 -->
            <div id="tab-short-story" class="tab-content active">
                <div class="inspiration-panel">
                    <div class="panel-header">
                        <h2>📝 短故事创作助手</h2>
                        <p class="panel-desc">3万字以内短篇完结故事,节奏紧凑,剧情跌宕</p>
                    </div>

                    <!-- 步骤指示器 -->
                    <div class="step-indicator">
                        <div class="step active" data-step="1">
                            <div class="step-number">1</div>
                            <div class="step-label">灵感收集</div>
                        </div>
                        <div class="step-arrow">→</div>
                        <div class="step" data-step="2">
                            <div class="step-number">2</div>
                            <div class="step-label">生成设定</div>
                        </div>
                        <div class="step-arrow">→</div>
                        <div class="step" data-step="3">
                            <div class="step-number">3</div>
                            <div class="step-label">生成大纲</div>
                        </div>
                        <div class="step-arrow">→</div>
                        <div class="step" data-step="4">
                            <div class="step-number">4</div>
                            <div class="step-label">生成章节</div>
                        </div>
                        <div class="step-arrow">→</div>
                        <div class="step" data-step="5">
                            <div class="step-number">5</div>
                            <div class="step-label">一键成文</div>
                        </div>
                        <div class="step-arrow">→</div>
                        <div class="step" data-step="6">
                            <div class="step-number">6</div>
                            <div class="step-label">AI审稿</div>
                        </div>
                    </div>

                    <!-- 步骤1: 灵感收集 -->
                    <div id="short-story-step-1" class="step-content active">
                        <div class="step-header">
                            <h3>📝 第一步: 灵感收集</h3>
                            <p>选择题材、爆点梗,填写灵感(留空则AI随机生成)</p>
                        </div>
                        <form id="short-story-form" class="inspiration-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>题材类型 *</label>
                                    <select id="short-story-genre" required>
                                        <option value="">请选择题材</option>
                                        <optgroup label="现代言情">
                                            <option value="现言甜宠">现言甜宠</option>
                                            <option value="现言虐恋">现言虐恋 (极致拉扯)</option>
                                            <option value="现实情感">现实情感</option>
                                            <option value="种田经商">种田经商</option>
                                        </optgroup>
                                        <optgroup label="古代言情">
                                            <option value="古言甜宠">古言甜宠</option>
                                            <option value="古言虐恋">古言虐恋</option>
                                        </optgroup>
                                        <optgroup label="悬疑/脑洞">
                                            <option value="悬疑推理">悬疑推理</option>
                                            <option value="规则怪谈">规则怪谈</option>
                                            <option value="无限流">无限流</option>
                                            <option value="末日幻想">末日幻想</option>
                                        </optgroup>
                                        <optgroup label="其他题材">
                                            <option value="现实生活">现实生活</option>
                                            <option value="科幻">科幻</option>
                                            <option value="自然冒险">自然冒险</option>
                                        </optgroup>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>叙事视角</label>
                                    <select id="short-story-perspective">
                                        <option value="first">第一人称</option>
                                        <option value="third">第三人称</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>爆点梗选择 (可多选)</label>
                                <div class="checkbox-group"
                                    style="max-height: 150px; overflow-y: auto; border: 1px solid #e5e7eb; padding: 1rem; border-radius: 8px;">
                                    <label><input type="checkbox" name="short-story-trope" value="心灰意冷"> 心灰意冷</label>
                                    <label><input type="checkbox" name="short-story-trope" value="复婚学乖"> 复婚学乖</label>
                                    <label><input type="checkbox" name="short-story-trope" value="重生只要家产">
                                        重生只要家产</label>
                                    <label><input type="checkbox" name="short-story-trope" value="久别重逢"> 久别重逢</label>
                                    <label><input type="checkbox" name="short-story-trope" value="替罪梗"> 替罪梗</label>
                                    <label><input type="checkbox" name="short-story-trope" value="换子疑云"> 换子疑云</label>
                                    <label><input type="checkbox" name="short-story-trope" value="听心声"> 听心声</label>
                                    <label><input type="checkbox" name="short-story-trope" value="萌宝"> 萌宝</label>
                                    <label><input type="checkbox" name="short-story-trope" value="真假千金"> 真假千金</label>
                                    <label><input type="checkbox" name="short-story-trope" value="地下恋当众社死">
                                        地下恋当众社死</label>
                                    <label><input type="checkbox" name="short-story-trope" value="新欢打脸"> 新欢打脸</label>
                                    <label><input type="checkbox" name="short-story-trope" value="丁克"> 坚持丁克</label>
                                    <label><input type="checkbox" name="short-story-trope" value="出轨"> 婚内出轨</label>
                                    <label><input type="checkbox" name="short-story-trope" value="渣男悔过"> 渣男悔过</label>
                                    <label><input type="checkbox" name="short-story-trope" value="死人文学">
                                        死人文学(白月光/必死)</label>
                                    <label><input type="checkbox" name="short-story-trope" value="追妻火葬场"> 追妻火葬场</label>
                                    <label><input type="checkbox" name="short-story-trope" value="真假千金"> 真假千金</label>
                                    <label><input type="checkbox" name="short-story-trope" value="破镜重圆"> 破镜重圆</label>
                                    <label><input type="checkbox" name="short-story-trope" value="替身文学"> 替身文学</label>
                                    <label><input type="checkbox" name="short-story-trope" value="带球跑"> 带球跑</label>
                                    <label><input type="checkbox" name="short-story-trope" value="绿茶"> 绿茶/白莲花</label>
                                    <label><input type="checkbox" name="short-story-trope" value="重生致富"> 重生致富</label>
                                    <label><input type="checkbox" name="short-story-trope" value="复仇"> 复仇打脸</label>
                                    <label><input type="checkbox" name="short-story-trope" value="马甲"> 掉马甲</label>
                                    <label><input type="checkbox" name="short-story-trope" value="团宠"> 团宠</label>
                                    <label><input type="checkbox" name="short-story-trope" value="玄学"> 玄学大佬</label>
                                    <label><input type="checkbox" name="short-story-trope" value="娱乐圈"> 娱乐圈</label>
                                    <label><input type="checkbox" name="short-story-trope" value="年代文"> 年代文</label>
                                    <label><input type="checkbox" name="short-story-trope" value="末世囤货"> 末世囤货</label>
                                    <label><input type="checkbox" name="short-story-trope" value="无限流"> 无限流</label>
                                    <label><input type="checkbox" name="short-story-trope" value="系统"> 系统绑定</label>
                                    <label><input type="checkbox" name="short-story-trope" value="捞女"> 捞女</label>
                                    <label><input type="checkbox" name="short-story-trope" value="脚踏N条船"> 脚踏N条船</label>
                                    <label><input type="checkbox" name="short-story-trope" value="非典型小三"> 非典型小三</label>
                                    <label><input type="checkbox" name="short-story-trope" value="天生犟种"> 天生犟种</label>
                                    <label><input type="checkbox" name="short-story-trope" value="坏种"> 坏种</label>
                                    <label><input type="checkbox" name="short-story-trope" value="反驳型人格"> 反驳型人格</label>
                                </div>
                            </div>

                            <div class="form-group">
                                <div
                                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                    <label style="margin-bottom: 0;">故事灵感/简介 (可选)</label>
                                    <label
                                        style="font-size: 0.85rem; color: var(--primary-color); cursor: pointer; display: flex; align-items: center;">
                                        <input type="checkbox" id="short-story-batch-mode"
                                            style="margin-right: 0.5rem;">
                                        批量灵感模式 (一行一个灵感)
                                    </label>
                                </div>
                                <textarea id="short-story-summary" rows="3"
                                    placeholder="描述你的故事灵感,例如:一个都市白领发现自己的老公竟然是..."></textarea>
                                <p id="short-story-batch-hint"
                                    style="display: none; font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.4rem;">
                                    💡 批量模式下，系统将为每一行文字单独生成一篇完整的短故事。
                                </p>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>目标字数</label>
                                    <select id="short-story-words">
                                        <option value="8000">8000字 (微短篇)</option>
                                        <option value="15000">15000字 (短篇)</option>
                                        <option value="22000" selected>22000字 (标准短篇)</option>
                                        <option value="30000">30000字 (上限)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>章节数</label>
                                    <select id="short-story-chapters">
                                        <option value="5">5章</option>
                                        <option value="8" selected>8章</option>
                                        <option value="10">10章</option>
                                        <option value="15">15章</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>生成数量</label>
                                    <select id="short-story-count">
                                        <option value="1" selected>1篇 (单篇)</option>
                                        <option value="2">2篇 (批量)</option>
                                        <option value="3">3篇 (批量)</option>
                                        <option value="5">5篇 (批量)</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn btn-primary" onclick="generateShortStorySettings()">✨
                                    生成设定</button>
                                <button type="button" class="btn btn-success" onclick="startShortStoryOneClick()"
                                    style="background-color: #10b981; margin-left: 10px;">🚀 一键生成全书</button>
                            </div>
                        </form>
                    </div>

                    <!-- 步骤2: 生成设定 -->
                    <div id="short-story-step-2" class="step-content" style="display: none;">
                        <div class="step-header">
                            <h3>📚 第二步: 小说设定</h3>
                            <p>AI生成的短故事设定,含30字标题和极致人设</p>
                        </div>
                        <div id="short-story-settings-content" class="settings-content">
                            <div class="loading-state">
                                <p>⏳ AI正在创作中,请稍候...</p>
                            </div>
                        </div>
                        <div class="form-actions" id="short-story-step-2-actions" style="display: none;">
                            <button type="button" class="btn" onclick="goToShortStoryStep(1)">← 返回</button>
                            <button type="button" class="btn btn-primary" onclick="generateShortStoryOutline()">→
                                生成大纲</button>
                        </div>
                    </div>

                    <!-- 步骤3: 生成大纲 -->
                    <div id="short-story-step-3" class="step-content" style="display: none;">
                        <div class="step-header">
                            <h3>📋 第三步: 章节大纲</h3>
                            <p>紧凑节奏,黄金三章设计,每节设置钩子</p>
                        </div>
                        <div id="short-story-outline-content" class="outline-content">
                            <div class="loading-state">
                                <p>⏳ AI正在生成大纲,请稍候...</p>
                            </div>
                        </div>
                        <div class="form-actions" id="short-story-step-3-actions" style="display: none;">
                            <button type="button" class="btn" onclick="goToShortStoryStep(2)">← 返回</button>
                            <button type="button" class="btn btn-primary" onclick="generateShortStoryChapters()">→
                                生成章节</button>
                        </div>
                    </div>

                    <!-- 步骤4: 生成章节 -->
                    <div id="short-story-step-4" class="step-content" style="display: none;">
                        <div class="step-header">
                            <h3>📖 第四步: 章节内容</h3>
                            <p>开头100字直入主题,心理描写重点</p>
                        </div>
                        <div id="short-story-chapters-content" class="chapters-content">
                            <div class="loading-state">
                                <p>⏳ AI正在创作章节,请稍候...</p>
                            </div>
                        </div>
                        <div class="form-actions" id="short-story-step-4-actions" style="display: none;">
                            <button type="button" class="btn" onclick="goToShortStoryStep(3)">← 返回</button>
                            <button type="button" class="btn btn-primary" onclick="generateShortStoryNovel()">→
                                一键成文</button>
                        </div>
                    </div>

                    <!-- 步骤5: 一键成文 -->
                    <div id="short-story-step-5" class="step-content" style="display: none;">
                        <div class="step-header">
                            <h3>🎉 第五步: 完成</h3>
                            <p>您的短故事已生成完毕!</p>
                        </div>
                        <div id="short-story-result" class="novel-result">
                            <div class="loading-state">
                                <p>⏳ 正在整合成文,请稍候...</p>
                            </div>
                        </div>
                        <div class="form-actions" id="short-story-step-5-actions" style="display: none;">
                            <button type="button" class="btn" onclick="exportShortStory()">📥 导出小说</button>
                            <button type="button" class="btn btn-success" onclick="startShortStoryReview()">🔍
                                提交AI审稿</button>
                            <button type="button" class="btn btn-primary" onclick="resetShortStory()">🔄 重新创作</button>
                        </div>
                    </div>

                    <!-- 步骤6: AI审稿 -->
                    <div id="short-story-step-6" class="step-content" style="display: none;">
                        <div class="step-header">
                            <h3>🔍 第六步: AI 爆文审稿助手</h3>
                            <p>深度诊断小说结构与情绪曲线,助你直达S级</p>
                        </div>

                        <div id="short-story-review-content" class="review-content">
                            <!-- 审稿报告 -->
                            <div class="loading-state">
                                <p>⏳ AI主编正在深度审读中...</p>
                            </div>
                        </div>

                        <div class="form-actions" id="short-story-step-6-actions" style="display: none;">
                            <button type="button" class="btn" onclick="goToShortStoryStep(5)">← 查看原文</button>
                            <button type="button" class="btn btn-primary" onclick="showShortStoryRewriteModal()">✍️
                                根据建议修改</button>
                            <button type="button" class="btn btn-success" onclick="exportShortStory()">📥 导出最终稿</button>
                        </div>
                    </div>
                </div>
            </div>


    </div>
    <div class="stat-card">
        <h4>核心冲突</h4>
        <p id="overview-conflict">-</p>
    </div>
    <div class="stat-card">
        <h4>人机比例</h4>
        <p id="overview-ratio">-</p>
    </div>
    <div class="stat-card">
        <h4>字数</h4>
        <p><span id="overview-words">0</span> / <span id="overview-target">0</span></p>
    </div>
    </div>
    </div>

    <!-- 工作流程标签 -->
    <div class="workflow-tabs">
        <button class="workflow-tab active" data-step="characters">
            <span class="step-number">1</span>
            👥 人物设定
        </button>
        <button class="workflow-tab" data-step="outlines">
            <span class="step-number">2</span>
            📋 情节大纲
        </button>
        <button class="workflow-tab" data-step="chapters">
            <span class="step-number">3</span>
            📝 章节创作
        </button>
    </div>

    <!-- 步骤1: 人物设定 -->
    <div id="step-characters" class="workflow-step active">
        <div class="step-header">
            <h3>👥 人物设定</h3>
            <div class="step-actions">
                <button class="btn btn-secondary" onclick="showCreateCharacterModal()">+ 手动创建</button>
                <button class="btn btn-primary" onclick="showGenerateCharacterModal()">✨ AI辅助生成</button>
            </div>
        </div>
        <div id="characters-grid" class="characters-grid">
            <p class="empty-state">请先选择一个项目，或创建新项目</p>
        </div>
    </div>

    <!-- 步骤2: 情节大纲 -->
    <div id="step-outlines" class="workflow-step" style="display: none;">
        <div class="step-header">
            <h3>📋 情节大纲</h3>
            <div class="step-actions">
                <button class="btn btn-primary" onclick="showCreateOutlineModal()">+ 新建大纲</button>
            </div>
        </div>
        <div id="outlines-list" class="outlines-list">
            <p class="empty-state">请先选择一个项目</p>
        </div>
    </div>

    <!-- 步骤3: 章节创作 -->
    <div id="step-chapters" class="workflow-step" style="display: none;">
        <div class="step-header">
            <h3>📝 章节创作</h3>
        </div>
        <div id="chapters-workspace" class="chapters-workspace">
            <p class="empty-state">请先创建情节大纲</p>
        </div>
    </div>
    </div>
    </div>







    <!-- 投稿详情模态框 -->
    <div id="submission-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">新建投稿</h3>
                <button class="modal-close" onclick="closeSubmissionModal()">✕</button>
            </div>
            <div class="modal-body">
                <form id="submission-form">
                    <input type="hidden" id="submission-id">

                    <div class="form-group">
                        <label>选择项目</label>
                        <select id="submission-project" required>
                            <option value="">请选择项目</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>投稿平台</label>
                        <select id="submission-platform" required>
                            <option value="番茄">番茄</option>
                            <option value="七猫">七猫</option>
                            <option value="灯下">灯下</option>
                            <option value="风行故事会">风行故事会</option>
                            <option value="墨墨言情">墨墨言情</option>
                            <option value="爆米花">爆米花</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>笔名</label>
                        <input type="text" id="submission-penname" value="鱼头" required>
                    </div>

                    <div class="form-group">
                        <label>书名</label>
                        <input type="text" id="submission-bookname" placeholder="输入书名" required>
                    </div>

                    <div class="form-group">
                        <label>主题</label>
                        <input type="text" id="submission-theme" placeholder="例如：追妻火葬场" required>
                    </div>

                    <div class="form-group">
                        <label>投稿状态</label>
                        <select id="submission-status">
                            <option value="pending">待投稿</option>
                            <option value="submitted">已投稿</option>
                            <option value="under_review">审核中</option>
                            <option value="approved">已通过</option>
                            <option value="rejected">已拒绝</option>
                            <option value="published">已发布</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>投稿日期</label>
                        <input type="date" id="submission-date">
                    </div>

                    <div class="form-group">
                        <label>备注</label>
                        <textarea id="submission-notes" rows="3" placeholder="备注信息..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="auto-generate" checked>
                            自动生成投稿标题和导语
                        </label>
                    </div>

                    <div id="generated-content" style="display: none;">
                        <div class="form-group">
                            <label>投稿标题（自动生成）</label>
                            <textarea id="submission-title" rows="2" readonly></textarea>
                            <button type="button" class="btn btn-sm btn-secondary"
                                onclick="copySubmissionTitle()">复制标题</button>
                        </div>

                        <div class="form-group">
                            <label>邮件导语（自动生成）</label>
                            <textarea id="submission-intro" rows="5" readonly></textarea>
                            <button type="button" class="btn btn-sm btn-secondary"
                                onclick="copySubmissionIntro()">复制导语</button>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeSubmissionModal()">取消</button>
                        <button type="submit" class="btn btn-primary">保存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 渠道智能体创建/编辑模态框 -->
    <div id="channel-agent-modal" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="channel-agent-modal-title">创建渠道智能体</h3>
                <button class="modal-close" onclick="closeChannelAgentModal()">✕</button>
            </div>
            <div class="modal-body">
                <form id="channel-agent-form">
                    <input type="hidden" id="channel-agent-id">

                    <!-- 基本信息 -->
                    <div class="form-section">
                        <h4>📋 基本信息</h4>
                        <div class="form-group">
                            <label>智能体名称 <span class="required">*</span></label>
                            <input type="text" id="channel-agent-name" placeholder="例如：武志红公众号" required>
                        </div>

                        <div class="form-group">
                            <label>描述</label>
                            <textarea id="channel-agent-description" rows="2" placeholder="描述这个智能体的用途..."></textarea>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>渠道类型</label>
                                <select id="channel-agent-type">
                                    <option value="emotion">💕 情感</option>
                                    <option value="story">📖 故事</option>
                                    <option value="parenting">👶 育儿</option>
                                    <option value="career">💼 职场</option>
                                    <option value="psychology">🧠 心理</option>
                                    <option value="general">📝 通用</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>目标受众</label>
                                <input type="text" id="channel-agent-audience" placeholder="例如：25-35岁都市女性">
                            </div>
                        </div>
                    </div>

                    <!-- 渠道特点 -->
                    <div class="form-section">
                        <h4>🎯 渠道特点</h4>
                        <div class="form-group">
                            <label>擅长话题</label>
                            <textarea id="channel-agent-topics" rows="2"
                                placeholder="例如：亲密关系,情感问题,婚姻经营,自我成长"></textarea>
                        </div>

                        <div class="form-group">
                            <label>文风要求</label>
                            <input type="text" id="channel-agent-tone" placeholder="例如：温暖、共情、细腻">
                        </div>

                        <div class="form-group">
                            <label>字数要求</label>
                            <div class="form-row">
                                <input type="number" id="channel-agent-min-words" placeholder="最小字数">
                                <input type="number" id="channel-agent-max-words" placeholder="最大字数">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>特殊要求</label>
                            <textarea id="channel-agent-requirements" rows="2"
                                placeholder="例如：需要有真实案例,避免说教..."></textarea>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeChannelAgentModal()">取消</button>
                        <button type="submit" class="btn btn-primary">保存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 语料上传模态框 -->
    <div id="corpus-upload-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>📤 上传训练语料</h3>
                <button class="modal-close" onclick="closeCorpusUploadModal()">✕</button>
            </div>
            <div class="modal-body">
                <form id="corpus-upload-form">
                    <input type="hidden" id="corpus-agent-id">

                    <div class="form-group">
                        <label>选择智能体</label>
                        <input type="text" id="corpus-agent-name" readonly style="background: #f5f5f5;">
                    </div>

                    <div class="form-group">
                        <label>上传语料文件 (.txt / .md)</label>
                        <div class="file-upload-area" id="corpus-drop-zone">
                            <input type="file" id="corpus-files" accept=".txt,.md,text/markdown,text/plain" multiple
                                style="display: none;">
                            <div class="upload-prompt">
                                <p>📁 拖拽文件到此处或点击上传</p>
                                <p class="upload-hint">支持多个.txt和.md文件，建议上传10-50篇该渠道的范文</p>
                            </div>
                            <div id="corpus-file-list" class="file-list"></div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeCorpusUploadModal()">取消</button>
                        <button type="submit" class="btn btn-primary">开始训练</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 内容生成模态框 -->
    <div id="content-generate-modal" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>✨ 生成投稿内容</h3>
                <button class="modal-close" onclick="closeGenerateModal()">✕</button>
            </div>
            <div class="modal-body">
                <form id="content-generate-form">
                    <input type="hidden" id="generate-agent-id">

                    <div class="form-group">
                        <label>使用智能体</label>
                        <input type="text" id="generate-agent-name" readonly style="background: #f5f5f5;">
                    </div>

                    <div class="form-group">
                        <label>文章主题（可选）</label>
                        <textarea id="generate-topic" rows="2" placeholder="留空则由AI根据渠道风格自主推荐主题，也可以输入你想写的主题"></textarea>
                        <p style="font-size: 0.85rem; color: #64748b; margin-top: 0.25rem;">💡
                            建议留空，让AI根据该渠道的风格自主创作更合适的主题</p>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>目标项目</label>
                            <select id="generate-project" onchange="handleProjectSelectChange()">
                                <option value="">不保存到项目</option>
                                <option value="__new__">+ 新建项目</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>字数</label>
                            <input type="number" id="generate-word-count" placeholder="自动">
                        </div>
                    </div>

                    <!-- 新建项目表单（默认隐藏） -->
                    <div id="new-project-form"
                        style="display: none; background: #f0f9ff; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid #0ea5e9;">
                        <div class="form-group">
                            <label>新项目名称 <span class="required">*</span></label>
                            <input type="text" id="new-project-name" placeholder="输入新项目名称" style="background: white;">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>额外要求</label>
                        <textarea id="generate-requirements" rows="2" placeholder="例如：需要包含具体的对话场景，要有反转..."></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeGenerateModal()">取消</button>
                        <button type="button" class="btn btn-info" onclick="generateInspiration()"
                            id="generate-inspiration-btn">💡 AI生成灵感</button>
                        <button type="button" class="btn btn-success" onclick="generateContent()"
                            id="generate-content-btn" disabled>✍️ AI生成内容</button>
                    </div>
                </form>

                <!-- 灵感编辑区域 -->
                <div id="inspiration-editor" style="display: none; margin-top: 1.5rem;">
                    <div class="form-section"
                        style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); padding: 1.5rem; border-radius: 12px; border-left: 4px solid #0ea5e9;">
                        <h4 style="margin: 0 0 1rem 0; color: #0369a1;">💡 AI生成的灵感</h4>

                        <div class="form-group">
                            <label>推荐主题</label>
                            <div id="inspiration-topic"
                                style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 1rem; border-radius: 8px; margin-bottom: 0.5rem; border-left: 4px solid #f59e0b; font-weight: 500; color: #92400e;">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>标题建议</label>
                            <div id="inspiration-titles"
                                style="background: white; padding: 0.75rem; border-radius: 8px; margin-bottom: 0.5rem;">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>核心角度</label>
                            <textarea id="inspiration-angle" rows="2" style="background: white;"></textarea>
                        </div>

                        <div class="form-group">
                            <label>内容大纲</label>
                            <textarea id="inspiration-outline" rows="6" style="background: white;"></textarea>
                        </div>

                        <div class="form-group">
                            <label>关键元素</label>
                            <input type="text" id="inspiration-elements" style="background: white;">
                        </div>

                        <div class="form-group">
                            <label>情绪弧线</label>
                            <textarea id="inspiration-emotional" rows="2" style="background: white;"></textarea>
                        </div>

                        <div class="form-group">
                            <label>创作要点</label>
                            <textarea id="inspiration-notes" rows="2" style="background: white;"></textarea>
                        </div>

                        <div class="form-actions" style="margin-top: 1rem;">
                            <button type="button" class="btn btn-secondary" onclick="regenerateInspiration()">🔄
                                重新生成灵感</button>
                            <button type="button" class="btn btn-success" onclick="confirmInspiration()">✅
                                确认并生成内容</button>
                        </div>
                    </div>
                </div>

                <!-- 生成进度提示 -->
                <div id="generation-progress"
                    style="display: none; margin-top: 1.5rem; padding: 1.5rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white; text-align: center;">
                    <div style="font-size: 3rem; margin-bottom: 1rem; animation: pulse 1.5s infinite;">✨</div>
                    <h4 style="margin: 0 0 0.5rem 0; font-size: 1.1rem;" id="progress-title">AI正在创作中...</h4>
                    <p style="margin: 0.5rem 0; opacity: 0.9; font-size: 0.9rem;" id="generation-progress-text">
                        正在分析主题和风格要求</p>
                    <div
                        style="margin-top: 1rem; background: rgba(255,255,255,0.2); height: 6px; border-radius: 3px; overflow: hidden;">
                        <div id="generation-progress-bar"
                            style="height: 100%; background: white; border-radius: 3px; transition: width 0.5s ease; width: 0%;">
                        </div>
                    </div>
                    <p style="margin: 0.8rem 0 0 0; opacity: 0.8; font-size: 0.85rem;" id="progress-time">预计需要
                        30-60 秒，请稍候...</p>
                </div>

                <!-- 生成结果 -->
                <div id="generation-result" style="display: none; margin-top: 1.5rem;">
                    <div class="form-section">
                        <h4>📝 生成内容</h4>
                        <div id="generated-content-display"
                            style="background: #f8fafc; padding: 1rem; border-radius: 8px; max-height: 400px; overflow-y: auto; white-space: pre-wrap; line-height: 1.8;">
                        </div>
                        <div class="form-actions" style="margin-top: 1rem;">
                            <button type="button" class="btn btn-secondary" onclick="copyGeneratedContent()">📋
                                复制内容</button>
                            <button type="button" class="btn btn-primary" onclick="saveToProject()">💾
                                保存到项目</button>
                            <button type="button" class="btn btn-secondary" onclick="regenerateContent()">🔄
                                重新生成</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    </main>


    <!-- 短故事重写弹窗 -->
    <div id="short-story-rewrite-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>✍️ 优化重构建议</h3>
                <button class="modal-close" onclick="closeShortStoryRewriteModal()">✕</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 1rem; font-size: 0.9rem; color: var(--text-secondary);">
                    AI将根据审稿报告调整故事结构。你也可以添加额外的修改要求：
                </p>
                <textarea id="short-story-rewrite-instruction" rows="4"
                    placeholder="例如：稍微增加一点甜宠戏份 / 把第二章的冲突写得再剧烈一点... (可选)"
                    style="width: 100%; padding: 0.8rem; border-radius: 8px; border: 1px solid var(--border-color);"></textarea>
            </div>
            <div class="modal-footer"
                style="padding: 1rem; border-top: 1px solid var(--border-color); display: flex; justify-content: flex-end; gap: 10px;">
                <button class="btn btn-secondary" onclick="closeShortStoryRewriteModal()">取消</button>
                <button class="btn btn-primary" onclick="executeShortStoryRewrite()">🚀 开始重构</button>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js?v=9"></script>
    <script src="/static/js/short-story.js?v=9"></script>
    <script src="/static/js/inspiration.js?v=9"></script>
    <script src="/static/js/ruyu.js?v=9"></script>
</body>

</html>