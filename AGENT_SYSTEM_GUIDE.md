# AI智能体系统 - 使用指南

## 🎉 功能概述

基于**如流写作（ruliuwriter.com）**的核心理念，我们成功实现了AI智能体系统，为小说生成工具增加了强大的可复用模板功能。

### 核心特性

1. **变量系统** - 使用 `{{变量名}}` 格式定义动态参数
2. **批量生成** - 一次生成多个版本供选择（1-5个）
3. **版本对比** - 并排显示生成的多个版本，支持选择最佳
4. **预设模板** - 内置官方智能体模板
5. **自定义智能体** - 支持用户创建专属智能体
6. **使用统计** - 记录使用次数和点赞数

---

## 📋 数据库模型

### Agent (智能体表)
- **基本信息**: name, description, category, agent_type
- **核心配置**: system_prompt（支持{{变量}}）, variables
- **参数设置**: ai_model, temperature, max_tokens, batch_count
- **权限管理**: visibility, access_token, access_expires_at, require_approval
- **统计**: usage_count, like_count

### AgentExecution (执行记录表)
- 记录每次执行的输入变量、参数、状态和时间

### AgentVersion (生成版本表)
- 保存批量生成的每个版本
- 支持用户选择和评分

---

## 🔌 API端点

### 智能体管理

| 方法 | 端点 | 说明 |
|------|------|------|
| GET | `/api/agents` | 获取智能体列表 |
| GET | `/api/agents/{id}` | 获取智能体详情 |
| POST | `/api/agents` | 创建智能体 |
| PUT | `/api/agents/{id}` | 更新智能体 |
| DELETE | `/api/agents/{id}` | 删除智能体 |

### 智能体执行

| 方法 | 端点 | 说明 |
|------|------|------|
| POST | `/api/agents/{id}/execute` | 执行智能体（批量生成）|
| GET | `/api/agents/{id}/executions` | 获取执行历史 |
| GET | `/api/executions/{id}/versions` | 获取生成的版本列表 |
| POST | `/api/versions/{id}/select` | 选择某个版本 |

---

## 🤖 内置官方智能体

### 1. 短篇导语生成器
- **功能**: 根据对标作品和导语，生成3个新的狗血导语
- **输入变量**:
  - `reference_work` (对标作品名称)
  - `reference_intro` (对标导语内容)
- **批量生成**: 3个版本
- **创意度**: 95%

### 2. 短篇小说大纲生成器
- **功能**: 根据对标作品和新导语，生成完整短篇大纲
- **输入变量**:
  - `reference_work` (对标作品名称)
  - `new_intro` (新导语内容)
- **输出格式**: JSON格式大纲（8-12章节）
- **创意度**: 90%

---

## 💡 使用流程

### 方式1: 使用官方智能体

1. 打开 **🤖 AI智能体** 标签页
2. 浏览智能体列表，选择需要的智能体
3. 点击 **🚀 使用** 按钮
4. 填写所需变量（如对标作品、导语等）
5. 点击 **🚀 开始生成**
6. **如果生成多个版本**:
   - 并排查看所有版本
   - 对比内容质量
   - 点击 **✅ 选择此版本** 标记最佳版本
   - 可以复制内容或使用到项目
7. **如果只生成一个版本**:
   - 直接查看结果
   - 复制到剪贴板使用

### 方式2: 创建自定义智能体（开发中）

1. 点击 **+ 创建智能体** 按钮
2. 填写基本信息:
   - 名称
   - 描述
   - 分类
3. 配置提示词:
   - 编写系统提示词
   - 使用 `{{变量名}}` 定义变量
4. 定义变量:
   - 变量名称
   - 变量类型（text/textarea）
   - 显示标签
   - 是否必填
5. 设置参数:
   - AI模型
   - 创意度（0-100）
   - 最大输出长度
   - 批量生成数量（1-5）
6. 保存并使用

---

## 📝 提示词编写指南

### 变量定义格式

在系统提示词中使用 `{{变量名}}` 格式：

```
你是一位专业的网文创作专家。

**对标作品：**
{{reference_work}}

**新导语：**
{{new_intro}}

请根据以上信息创作...
```

### 最佳实践

1. **清晰的指令**: 明确告诉AI要做什么
2. **格式要求**: 指定输出的格式（JSON、纯文本等）
3. **约束条件**: 字数限制、风格要求等
4. **示例输出**: 如果需要，提供输出格式示例
5. **批量生成提示**: 当需要多个版本时，在提示词中说明"直接输出第N个版本"

---

## 🎨 界面功能

### 智能体标签页
- 分类筛选: 全部、导语生成、大纲生成、人物生成、章节生成、自定义
- 智能体卡片: 显示名称、描述、标签、使用统计
- 官方标识: 显示"官方"徽章

### 执行模态框
- 动态生成变量输入表单
- 支持文本框和多行文本框
- 必填项标记

### 版本对比界面
- 并排显示多个版本
- 支持选择最佳版本
- 一键复制功能
- 集成到项目功能（开发中）

---

## 🚀 系统架构

```
前端 (agents.js)
    ↓
API层 (app.py)
    ↓
变量替换 (replace_variables)
    ↓
AI生成 (DeepSeekClient)
    ↓
批量保存 (AgentVersion)
    ↓
版本对比展示
```

---

## 📊 对比我们的工具 vs 如流写作

| 功能 | 如流写作 | 我们的工具 |
|------|---------|-----------|
| 变量系统 | ✅ {{变量名}} | ✅ 已实现 |
| 批量生成 | ✅ 支持 | ✅ 已实现（1-5个版本）|
| 版本对比 | ✅ 支持 | ✅ 已实现 |
| 官方智能体 | ✅ 多个 | ✅ 2个（导语、大纲）|
| 自定义智能体 | ✅ 支持 | ⏳ 前端开发中 |
| 权限管理 | ✅ 公开/链接/授权 | ✅ 数据库支持（前端开发中）|
| 使用统计 | ✅ 支持 | ✅ 已实现 |
| 三生万物法 | ✅ 智能体+情节卡+技能卡 | ⏳ 仅智能体 |

---

## 🛠️ 技术栈

- **后端**: FastAPI + SQLAlchemy + SQLite
- **前端**: 原生JavaScript + CSS Grid/Flexbox
- **AI**: DeepSeek API
- **架构**: RESTful API

---

## 📦 文件结构

```
backend/
├── database/
│   ├── models.py (新增: Agent, AgentExecution, AgentVersion, AgentShare)
│   └── __init__.py
├── api/
│   └── app.py (新增: 智能体相关API端点)
frontend/
├── index.html (新增: 智能体标签页和模态框)
├── static/
│   ├── js/
│   │   └── agents.js (新文件)
│   └── css/
│       └── style.css (新增: 智能体样式)
```

---

## 🎯 下一步计划

1. **完善自定义智能体** - 实现创建和编辑界面
2. **权限管理界面** - 实现分享链接、审批流程
3. **更多官方智能体** - 人物生成、章节生成等
4. **智能体市场** - 用户可以分享和下载智能体
5. **使用数据分析** - 查看最常用的智能体、最佳版本等

---

## 🧪 测试

### 测试智能体API
```bash
# 获取智能体列表
curl http://127.0.0.1:8000/api/agents

# 获取智能体详情
curl http://127.0.0.1:8000/api/agents/1

# 执行智能体
curl -X POST http://127.0.0.1:8000/api/agents/1/execute \
  -H "Content-Type: application/json" \
  -d '{"variables": {"reference_work": "测试作品", "reference_intro": "测试导语"}}'
```

---

## ✅ 已完成功能

- [x] 数据库模型设计
- [x] API端点实现
- [x] 变量替换系统
- [x] 批量生成功能
- [x] 版本对比界面
- [x] 官方智能体模板
- [x] 前端界面
- [x] CSS样式

---

## 🌟 核心优势

相比如流写作，我们的工具额外提供：
1. **完全开源** - 可自行部署和定制
2. **人机协作写作** - 细粒度的创作流程管理
3. **项目集成** - 直接将生成内容应用到项目
4. **本地部署** - 数据隐私保护
5. **成本控制** - 使用自己的API密钥

---

**服务器地址**: http://127.0.0.1:8000

**默认智能体已初始化**: ✅ 短篇导语生成器、短篇小说大纲生成器
